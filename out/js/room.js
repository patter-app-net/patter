
eval("// util.js\r\n//\r\n// General utility functions of use to any JavaScript project\r\n\r\n/*global define:true */\r\ndefine(\'util\',[\'jquery\'], function ($) {\r\n  \'use strict\';\r\n\r\n  var util = {};\r\n\r\n  util.redirect = function (dest)\r\n  {\r\n    window.location = dest;\r\n  };\r\n\r\n  util.getUrlVars = function ()\r\n  {\r\n    var vars = [], hash;\r\n    var hashes = window.location.href.slice(window.location.href.indexOf(\'?\') + 1).split(\'&\');\r\n    var i = 0;\r\n    for (i = 0; i < hashes.length; i += 1)\r\n    {\r\n      hash = hashes[i].split(\'=\');\r\n      vars.push(hash[0]);\r\n      vars[hash[0]] = hash[1];\r\n    }\r\n    return vars;\r\n  };\r\n\r\n  util.htmlEncode = function (value)\r\n  {\r\n    var result = \'\';\r\n    if (value) {\r\n      result = $(\'<div />\').text(value).html();\r\n    }\r\n    return result;\r\n  };\r\n\r\n  util.htmlDecode = function (value)\r\n  {\r\n    var result = \'\';\r\n    if (value) {\r\n      result = $(\'<div />\').html(value).text();\r\n    }\r\n    return result;\r\n  };\r\n\r\n\r\n  util.stripSpaces = function (str)\r\n  {\r\n    return str.replace(/ +$/g, \'\').replace(/^ +/g, \'\');\r\n  };\r\n\r\n  util.flagError = function (id, message)\r\n  {\r\n    var newAlert = \'<div class=\"alert alert-error\">\' +\r\n          \'<button type=\"button\" class=\"close\" data-dismiss=\"alert\">&times;</button>\' +\r\n          \'<strong>Error:</strong> \' + message +\r\n          \'</div>\';\r\n    $(\'#\' + id).html(newAlert);\r\n  };\r\n\r\n  util.has_focus = true;\r\n  $(window).on(\'focus\', function () {\r\n    util.has_focus = true;\r\n  });\r\n  $(window).on(\'blur\', function () {\r\n    util.has_focus = false;\r\n  });\r\n\r\n  return util;\r\n});\r\n\n//@ sourceURL=/js/util.js");

/*!
 * jQuery Cookie Plugin v1.3
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function ($, document, undefined) {

	var pluses = /\+/g;

	function raw(s) {
		return s;
	}

	function decoded(s) {
		return decodeURIComponent(s.replace(pluses, ' '));
	}

	var config = $.cookie = function (key, value, options) {

		// write
		if (value !== undefined) {
			options = $.extend({}, config.defaults, options);

			if (value === null) {
				options.expires = -1;
			}

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setDate(t.getDate() + days);
			}

			value = config.json ? JSON.stringify(value) : String(value);

			return (document.cookie = [
				encodeURIComponent(key), '=', config.raw ? value : encodeURIComponent(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// read
		var decode = config.raw ? raw : decoded;
		var cookies = document.cookie.split('; ');
		for (var i = 0, parts; (parts = cookies[i] && cookies[i].split('=')); i++) {
			if (decode(parts.shift()) === key) {
				var cookie = decode(parts.join('='));
				return config.json ? JSON.parse(cookie) : cookie;
			}
		}

		return null;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) !== null) {
			$.cookie(key, null, options);
			return true;
		}
		return false;
	};

})(jQuery, document);

define("jquery-cookie", function(){});

eval("// appnet-api.js\r\n//\r\n// API calls on the app.net web service\r\n\r\n/*global define: true */\r\ndefine(\'appnet-api\',[\'jquery\', \'util\', \'jquery-cookie\'],\r\nfunction ($, util) {\r\n  \'use strict\';\r\n\r\n  var api = {\r\n    accessToken: null\r\n  };\r\n\r\n  var authCookie = \'appnetToken\';\r\n  var urlCookie = \'appnetPrevUrl\';\r\n\r\n  api.init = function (newAuthCookie, newUrlCookie)\r\n  {\r\n    authCookie = newAuthCookie;\r\n    urlCookie = newUrlCookie;\r\n\r\n    api.accessToken = $.cookie(authCookie);\r\n    if (api.accessToken)\r\n    {\r\n      $.removeCookie(authCookie, { path: \'/\' });\r\n      localStorage[authCookie] = api.accessToken;\r\n    }\r\n    else\r\n    {\r\n      api.accessToken = localStorage[authCookie];\r\n    }\r\n  };\r\n\r\n  var callSuccess = function (response)\r\n  {\r\n    if (response !== null &&\r\n\tresponse.meta !== undefined &&\r\n\tresponse.data !== undefined)\r\n    {\r\n      if (this.success)\r\n      {\r\n        this.success(response);\r\n      }\r\n    }\r\n    else\r\n    {\r\n      if (this.failure)\r\n      {\r\n        console.log(\'AppNet null response\');\r\n        console.dir(response);\r\n        this.failure(response.meta);\r\n      }\r\n    }\r\n  };\r\n\r\n  var callFailure = function (request, status, thrown)\r\n  {\r\n    console.log(\'AppNet call failed: \' + status + \', thrown: \' + thrown);\r\n    console.dir(request.responseText);\r\n    var meta = null;\r\n    if (request.responseText) {\r\n      var response = JSON.parse(request.responseText);\r\n      if (response !== null) {\r\n        meta = response.meta;\r\n      }\r\n    }\r\n    if (this.failure) {\r\n      this.failure(meta);\r\n    }\r\n  };\r\n\r\n  function makeArgs(args)\r\n  {\r\n    var result = \'\';\r\n    if (args)\r\n    {\r\n      result = $.param(args);\r\n    }\r\n    if (result !== \'\')\r\n    {\r\n      result = \'?\' + result;\r\n    }\r\n    return result;\r\n  }\r\n    \r\n  function makeData(data)\r\n  {\r\n    var result = null;\r\n    if (data)\r\n    {\r\n      result = JSON.stringify(data);\r\n    }\r\n    return result;\r\n  }\r\n  \r\n  function makeUrl(pieces)\r\n  {\r\n    var result = \'\';\r\n    var i = 0;\r\n    for (i = 0; i < pieces.length; i += 1)\r\n    {\r\n      if (pieces[i])\r\n      {\r\n        result += pieces[i];\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  function add(name, type, url)\r\n  {\r\n    api[name] = function (args, success, failure) {\r\n      this.call(url, type, args, success, failure);\r\n    };\r\n  }\r\n\r\n  function addOne(name, type, prefix, suffix)\r\n  {\r\n    api[name] = function (target, args, success, failure) {\r\n      var url = makeUrl([prefix, target, suffix]);\r\n      this.call(url, type, args, success, failure);\r\n    };\r\n  }\r\n    \r\n  function addTwo(name, type, prefix, middle, suffix)\r\n  {\r\n    api[name] = function (first, second, args, success, failure) {\r\n      var url = makeUrl([prefix, first, middle, second, suffix]);\r\n      this.call(url, type, args, success, failure);\r\n    };\r\n  }\r\n\r\n  function addList(name, type, url)\r\n  {\r\n    api[name] = function (list, argsIn, success, failure) {\r\n      var ids = list.join(\',\');\r\n      var args = { ids: ids};\r\n      $.extend(args, argsIn);\r\n      this.call(url, type, args, success, failure);\r\n    };\r\n  }\r\n\r\n  function addData(name, type, url)\r\n  {\r\n    api[name] = function (data, args, success, failure) {\r\n      this.call(url, type, args, success, failure, data);\r\n    };\r\n  }\r\n\r\n  function addDataOne(name, type, prefix, suffix)\r\n  {\r\n    api[name] = function (target, data, args, success, failure) {\r\n      var url = makeUrl([prefix, target, suffix]);\r\n      this.call(url, type, args, success, failure, data);\r\n    };\r\n  }\r\n\r\n  function allFromSingle(single)\r\n  {\r\n    return function (args, success, failure)\r\n    {\r\n      if (! args)\r\n      {\r\n        args = {};\r\n      }\r\n      args.count = 200;\r\n      var result = [];\r\n\r\n      function fetchMore(response)\r\n      {\r\n        result = result.concat(response.data);\r\n        if (response.meta.more)\r\n        {\r\n          args.before_id = response.meta.min_id;\r\n          single(args, fetchMore, failure);\r\n        }\r\n        else\r\n        {\r\n          success({ data: result });\r\n        }\r\n      }\r\n\r\n      single(args, fetchMore, failure);\r\n    };\r\n  }\r\n\r\n  function addAll(name, single)\r\n  {\r\n    api[name] = allFromSingle(single);\r\n  }\r\n\r\n  function addAllOne(name, single)\r\n  {\r\n    api[name] = function (target, args, success, failure)\r\n    {\r\n      var callWithTarget = function (a, b, c) {\r\n        return single(target, a, b, c);\r\n      };\r\n      allFromSingle(callWithTarget)(args, success, failure);\r\n    };\r\n  }\r\n\r\n  function addAllList(name, single)\r\n  {\r\n    api[name] = function (list, args, success, failure)\r\n    {\r\n      var start = 0;\r\n      var end = (list.length < 200 ? list.length : 200);\r\n      var result = [];\r\n\r\n      function fetchMore(response)\r\n      {\r\n        result = result.concat(response.data);\r\n        start += 200;\r\n        end = (list.length < start + 200 ? list.length : 200);\r\n        if (start < list.length)\r\n        {\r\n          single(list.slice(start, end), args, fetchMore, failure);\r\n        }\r\n        else\r\n        {\r\n          success({ data: result });\r\n        }\r\n      }\r\n\r\n      single(list.slice(start, end), args, fetchMore, failure);\r\n    };\r\n  }\r\n\r\n  // ------------------------------------------------------------------------\r\n  // User\r\n  // ------------------------------------------------------------------------\r\n\r\n  // getUser(userId, args, success, failure);\r\n  addOne(\'getUser\', \'GET\',\r\n         \'https://alpha-api.app.net/stream/0/users/\');\r\n\r\n  // getUserList([userId1, userId2], args, success, failure);\r\n  addList(\'getUserList\', \'GET\',\r\n          \'https://alpha-api.app.net/stream/0/users\');\r\n\r\n  // getAllUserList([userId1, userId2], args, success, failure);\r\n  addAllList(\'getAllUserList\', $.proxy(api.getUserList, api));\r\n\r\n  // updateUser(newUserObject, args, success, failure);\r\n  addData(\'updateUser\', \'PUT\',\r\n          \'https://alpha-api.app.net/stream/0/users/me\');\r\n\r\n  addOne(\'getFollowers\', \'GET\',\r\n         \'https://alpha-api.app.net/stream/0/users/\', \'/followers\');\r\n\r\n  addOne(\'getFollowing\', \'GET\',\r\n         \'https://alpha-api.app.net/stream/0/users/\', \'/following\');\r\n\r\n  api.setUserAnnotations = function (notes, success, failure)\r\n  {\r\n    var context = {\r\n      notes: notes,\r\n      success: success,\r\n      failure: failure\r\n    };\r\n    api.getUser(\'me\', null, $.proxy(completeUserAnnotation, context), failure);\r\n  };\r\n\r\n  var completeUserAnnotation = function (response)\r\n  {\r\n    var user = response.data;\r\n    var locale = user.locale;\r\n    if (locale === \'en_US\')\r\n    {\r\n      locale = \'en\';\r\n    }\r\n    var newUser = {\r\n      name: user.name,\r\n      locale: locale,\r\n      timezone: user.timezone,\r\n      description: {\r\n        text: user.description.text,\r\n        entities: {\r\n          links: user.description.entities.links\r\n        }\r\n      },\r\n      annotations: this.notes\r\n    };\r\n    api.updateUser(newUser, { include_annotations: 1 },\r\n                   this.success, this.failure);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------\r\n  // Channel\r\n  // ------------------------------------------------------------------------\r\n\r\n  // createChannel\r\n  addData(\'createChannel\', \'POST\',\r\n          \'https://alpha-api.app.net/stream/0/channels\');\r\n\r\n  // getChannel(channelId, args, success, failure);\r\n  addOne(\'getChannel\', \'GET\',\r\n         \'https://alpha-api.app.net/stream/0/channels/\');\r\n\r\n  // getChannelList([channelId1, channelId2], args, success, failure);\r\n  addList(\'getChannelList\', \'GET\',\r\n          \'https://alpha-api.app.net/stream/0/channels/\');\r\n\r\n  // getAllChannelList([channelId1, channelId2], args, success, failure);\r\n  addAllList(\'getAllChannelList\', $.proxy(api.getChannelList, api));\r\n\r\n  // updateChannel(channelId, newChannel, args, success, failure);\r\n  addDataOne(\'updateChannel\', \'PUT\',\r\n             \'https://alpha-api.app.net/stream/0/channels/\');\r\n\r\n  api.createSharedFeed = function (name, success, failure)\r\n  {\r\n    var channel = {\r\n      type: \'net.share-app.feed\',\r\n      annotations: [{\r\n        type: \'net.share-app.feed\',\r\n        value: {\r\n          name: name\r\n        }\r\n      }],\r\n      readers: { \'public\': true },\r\n      writers: { any_user: true },\r\n      auto_subscribe: true\r\n    };\r\n    api.createChannel(channel, { include_annotations: 1 }, success, failure);\r\n  };\r\n\r\n  api.createShareStorage = function (success, failure)\r\n  {\r\n    var channel = {\r\n      type: \'net.share-app.storage\',\r\n      auto_subscribe: true\r\n    };\r\n    api.createChannel(channel, { include_annotations: 1 }, success, failure);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------\r\n  // Message\r\n  // ------------------------------------------------------------------------\r\n\r\n  // getMessages(channelId, args, success, failure);\r\n  addOne(\'getMessages\', \'GET\',\r\n         \'https://alpha-api.app.net/stream/0/channels/\', \'/messages\');\r\n\r\n  // getAllMessages(channelId, args, success, failure);\r\n  addAllOne(\'getAllMessages\', $.proxy(api.getMessages, api));\r\n\r\n  // createMessage(channelId, newMessage, args, success, failure);\r\n  addDataOne(\'createMessage\', \'POST\',\r\n             \'https://alpha-api.app.net/stream/0/channels/\', \'/messages\');\r\n\r\n  // deleteMessage(channelId, messageId, args, success, failure);\r\n  addTwo(\'deleteMessage\', \'DELETE\',\r\n         \'https://alpha-api.app.net/stream/0/channels/\', \'/messages/\');\r\n\r\n  api.shareItem = function (channelId, comment, link, title, content,\r\n                            success, failure)\r\n  {\r\n    var message = {\r\n      text: comment,\r\n      annotations: [{\r\n        type: \'net.share-app.item\',\r\n        value: { link: link }\r\n      }, {\r\n        type: \'net.app.core.oembed\',\r\n        value: {\r\n          type: \'rich\',\r\n          version: \'1.0\',\r\n          title: title,\r\n          html: content,\r\n          width: \'600\',\r\n          height: \'600\',\r\n          embeddable_url: link\r\n        }\r\n      }]\r\n    };\r\n    api.createMessage(channelId, message, { include_annotations: 1 },\r\n                      success, failure);\r\n  };\r\n\r\n  api.storeSubscription = function (channelId, url, title, success, failure)\r\n  {\r\n    var message = {\r\n      text: \'Subscribed to Feed URL: \' + url,\r\n      annotations: [{\r\n        type: \'net.share-app.subscription\',\r\n        value: {\r\n          link: url,\r\n          title: title\r\n        }\r\n      }]\r\n    };\r\n    api.createMessage(channelId, message, { include_annotations: 1 },\r\n                      success, failure);\r\n  };\r\n\r\n  // ------------------------------------------------------------------------\r\n  // Post\r\n  // ------------------------------------------------------------------------\r\n\r\n  // createPost(newPost, args, success, failure);\r\n  addData(\'createPost\', \'POST\',\r\n          \'https://alpha-api.app.net/stream/0/posts\');\r\n\r\n  // ------------------------------------------------------------------------\r\n  // Subscription\r\n  // ------------------------------------------------------------------------\r\n\r\n  // getSubscriptions(args, success, failure);\r\n  add(\'getSubscriptions\', \'GET\',\r\n      \'https://alpha-api.app.net/stream/0/channels/\');\r\n\r\n  // getAllSubscriptions(args, success, failure);\r\n  addAll(\'getAllSubscriptions\', $.proxy(api.getSubscriptions, api));\r\n\r\n  // createSubscription(channelId, args, success, failure);\r\n  addOne(\'createSubscription\', \'POST\',\r\n         \'https://alpha-api.app.net/stream/0/channels/\', \'/subscribe\');\r\n\r\n  // deleteSubscription(channelId, args, success, failure);\r\n  addOne(\'deleteSubscription\', \'DELETE\',\r\n         \'https://alpha-api.app.net/stream/0/channels/\', \'/subscribe\');\r\n\r\n  // ------------------------------------------------------------------------\r\n  // Marker\r\n  // ------------------------------------------------------------------------\r\n\r\n  // updateMarker(newMarker, args, success, failure);\r\n  addData(\'updateMarker\', \'POST\',\r\n          \'https://alpha-api.app.net/stream/0/posts/marker\');\r\n\r\n  addData(\'processText\', \'POST\',\r\n          \'https://alpha-api.app.net/stream/0/text/process\');\r\n\r\n  api.authorize = function ()\r\n  {\r\n    $.cookie(urlCookie, window.location, { expires: 1, path: \'/\' });\r\n    util.redirect(\'auth.html\');\r\n  };\r\n  \r\n  api.call = function (url, type, args, success, failure, data)\r\n  {\r\n    var complete = {\r\n      success: success,\r\n      failure: failure\r\n    };\r\n    var options = {\r\n      contentType: \'application/json\',\r\n      dataType: \'json\',\r\n      type: type,\r\n      url: url + makeArgs(args)\r\n    };\r\n    if (this.accessToken) {\r\n      options.headers = { Authorization: \'Bearer \' + this.accessToken };\r\n    }\r\n    if (data) {\r\n      options.data = makeData(data);\r\n    }\r\n    var header = $.ajax(options);\r\n    header.done($.proxy(callSuccess, complete));\r\n    header.fail($.proxy(callFailure, complete));\r\n  };\r\n  \r\n  return api;\r\n});\r\n\n//@ sourceURL=/js/appnet-api.js");

eval("// appnet-note.js\r\n//\r\n// Functions to create and process app.net annotations\r\n\r\n/*global define: true */\r\ndefine(\'appnet-note\',[\'util\'], function (util) {\r\n  \'use strict\';\r\n\r\n  var note = {};\r\n\r\n  note.findAnnotation = function (type, list)\r\n  {\r\n    var result = null;\r\n    var i = 0;\r\n    if (list)\r\n    {\r\n      for (i = 0; i < list.length; i += 1)\r\n      {\r\n        if (list[i].type === type)\r\n        {\r\n          result = list[i].value;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  };\r\n\r\n  note.findPatterSettings = function (channel)\r\n  {\r\n    var result = null;\r\n    if (channel)\r\n    {\r\n      result = note.findAnnotation(\'net.patter-app.settings\',\r\n                                   channel.annotations);\r\n    }\r\n    if (result === null)\r\n    {\r\n      result = {};\r\n    }\r\n    return result;\r\n  };\r\n\r\n  note.findPatterName = function (channel)\r\n  {\r\n    var name = null;\r\n    var settings = note.findAnnotation(\'net.patter-app.settings\',\r\n                                       channel.annotations);\r\n    if (settings !== null && settings.name !== undefined)\r\n    {\r\n      name = settings.name;\r\n    }\r\n    return name;\r\n  };\r\n\r\n  note.findBlogName = function (channel)\r\n  {\r\n    var name = null;\r\n    var settings = note.findAnnotation(\'net.blog-app.settings\',\r\n                                       channel.annotations);\r\n    if (settings !== null && settings.name !== undefined)\r\n    {\r\n      name = settings.name;\r\n    }\r\n    return name;\r\n  };\r\n\r\n  note.findChannelRefId = function (message)\r\n  {\r\n    var id = null;\r\n    if (message)\r\n    {\r\n      var ref = note.findAnnotation(\'net.view-app.channel-ref\',\r\n                                    message.annotations);\r\n      if (ref && ref.id)\r\n      {\r\n        id = ref.id;\r\n      }\r\n    }\r\n    return id;\r\n  };\r\n\r\n  note.broadcastNote = function (id, url) {\r\n    return {\r\n      type: \'net.patter-app.broadcast\',\r\n      value: {\r\n        id: id,\r\n        url: url\r\n      }\r\n    };\r\n  };\r\n\r\n  note.embedImageNote = function (url, widthIn, heightIn) {\r\n    var width = widthIn;\r\n    if (widthIn === null ||\r\n        widthIn === undefined)\r\n    {\r\n      width = 300;\r\n    }\r\n    var height = heightIn;\r\n    if (heightIn === null ||\r\n        heightIn === undefined)\r\n    {\r\n      height = 300;\r\n    }\r\n    return {\r\n      type: \'net.app.core.oembed\',\r\n      value: {\r\n        version: \'1.0\',\r\n        type: \'photo\',\r\n        width: width,\r\n        height: height,\r\n        url: util.stripSpaces(url)\r\n      }\r\n    };\r\n  };\r\n\r\n  note.channelRefNote = function (id, name, userId, type) {\r\n    return {\r\n      type: \'net.view-app.channel-ref\',\r\n      value: {\r\n        id: id,\r\n        label: name,\r\n        owner_id: userId,\r\n        type: type\r\n      }\r\n    };\r\n  };\r\n\r\n  return note;\r\n});\r\n\n//@ sourceURL=/js/appnet-note.js");

eval("// base.js\r\n//\r\n// Utility functions for dealing with app.net\r\n\r\n/*global define:true */\r\ndefine(\'appnet\',[\'jquery\', \'util\', \'appnet-api\', \'appnet-note\'],\r\nfunction ($, util, api, note) {\r\n  \'use strict\';\r\n\r\n  var appnet = {\r\n    api: api,\r\n    note: note,\r\n    user: null\r\n  };\r\n\r\n  appnet.init = function (tokenCookie, urlCookie)\r\n  {\r\n    this.api.init(tokenCookie, urlCookie);\r\n  };\r\n\r\n  appnet.isLogged = function () {\r\n    return this.api.accessToken !== null && this.api.accessToken !== undefined;\r\n  };\r\n\r\n  var updateUserSuccess = function (response) {\r\n    appnet.user = response.data;\r\n    if (this.success)\r\n    {\r\n      this.success(response);\r\n    }\r\n  };\r\n\r\n  var updateUserFailure = function (meta)\r\n  {\r\n    if (this.failure)\r\n    {\r\n      this.failure(meta);\r\n    }\r\n  };\r\n\r\n  appnet.updateUser = function (success, failure)\r\n  {\r\n    var complete = {\r\n      success: success,\r\n      failure: failure\r\n    };\r\n    api.getUser(\'me\', { \'include_annotations\': 1 },\r\n                   $.proxy(updateUserSuccess, complete),\r\n                   $.proxy(updateUserFailure, complete));\r\n  };\r\n\r\n\r\n  appnet.textToHtml = function (text, entitiesIn)\r\n  {\r\n    var result = $(\'<div/>\');\r\n    var entities = sortEntities(entitiesIn);\r\n    var anchor = 0;\r\n    var entity, link;\r\n    var i = 0;\r\n    for (i = 0; i < entities.length; i += 1) {\r\n      entity = entities[i].entity;\r\n      result.append(util.htmlEncode(text.substr(anchor, entity.pos - anchor)));\r\n      link = $(\'<a target=\"_blank\"/>\');\r\n      if (entities[i].type === \'mentions\')\r\n      {\r\n        link.addClass(\'mention\');\r\n        link.attr(\'href\',\r\n                  \'http://alpha.app.net/\' + util.htmlEncode(entity.name));\r\n        link.append(util.htmlEncode(\'@\' + entity.name));\r\n      }\r\n      else if (entities[i].type === \'hashtags\')\r\n      {\r\n        link.addClass(\'hashtag\');\r\n        link.attr(\'href\',\r\n                  \'http://alpha.app.net/hashtags/\' +\r\n                  util.htmlEncode(entity.name));\r\n        link.append(util.htmlEncode(\'#\' + entity.name));\r\n      }\r\n      else if (entities[i].type === \'links\')\r\n      {\r\n        link.addClass(\'link\');\r\n        link.attr(\'href\', entity.url);\r\n        link.append(util.htmlEncode(entity.text));\r\n      }\r\n      result.append(link);\r\n      anchor = entity.pos + entity.len;\r\n    }\r\n    result.append(util.htmlEncode(text.substr(anchor)));\r\n    return result;\r\n  };\r\n\r\n  function sortEntities(entities)\r\n  {\r\n    var result = [];\r\n    var typeList = [\'mentions\', \'hashtags\', \'links\'];\r\n    var i = 0;\r\n    var j = 0;\r\n    for (i = 0; i < typeList.length; i += 1)\r\n    {\r\n      var type = typeList[i];\r\n      for (j = 0; j < entities[type].length; j += 1)\r\n      {\r\n        result.push({pos: entities[type][j].pos,\r\n                     type: type,\r\n                     entity: entities[type][j]});\r\n      }\r\n    }\r\n    result.sort(function (left, right) {\r\n      return left.pos - right.pos;\r\n    });\r\n    return result;\r\n  }\r\n\r\n  appnet.renderStatus = function (channel)\r\n  {\r\n    var locked = (channel.readers.immutable && channel.writers.immutable);\r\n    var lockStatus = \'\';\r\n    if (locked) {\r\n      lockStatus = \'<i class=\"icon-lock\"></i> \';\r\n    }\r\n    var status = \'<span class=\"label\">\' + lockStatus + \'Private</span>\';\r\n    if (channel.readers[\'public\'] || channel.readers.any_user) {\r\n      status = \'<span class=\"label label-success\">\' + lockStatus +\r\n        \'Public Read</span>\';\r\n    }\r\n    if (channel.writers[\'public\'] || channel.writers.any_user) {\r\n      status = \'<span class=\"label label-success\">\' + lockStatus +\r\n        \'Public</span>\';\r\n    }\r\n    return status;\r\n  };\r\n\r\n  return appnet;\r\n});\r\n\n//@ sourceURL=/js/appnet.js");

eval("// roomInfo.js\n//\n// Information about the current room the user is chatting in.\n\n/*global define:true */\ndefine(\'js/roomInfo\',[\'jquery\', \'util\', \'appnet\'], function ($, util, appnet) {\n  \'use strict\';\n\n  var roomInfo = {\n    id: null,\n    channel: null,\n    members: {},\n    changeCallback: null\n  };\n\n  roomInfo.updateChannel = function ()\n  {\n//    $(\'#loading-message\').html(\"Fetching Channel Information\");\n    appnet.api.getChannel(this.id, {include_annotations: 1},\n                          $.proxy(this.completeChannelInfo, this),\n                          $.proxy(failChannelInfo, this));\n  };\n\n  roomInfo.completeChannelInfo = function (response)\n  {\n    var owner = response.data.owner;\n    var keyList = Object.keys(this.members);\n    var i = 0;\n    this.channel = response.data;\n    var name = appnet.note.findPatterName(this.channel);\n    if (name)\n    {\n      $(\'title\').html(util.htmlEncode(name) + \' (Patter)\');\n    }\n    else\n    {\n      $(\'title\').html(\'Private Message Channel (Patter)\');\n    }\n    for (i = 0; i < keyList.length; i += 1)\n    {\n      delete this.members[keyList[i]];\n    }\n    this.members[owner.username] = owner;\n    getWriterInfo();\n  };\n\n  var failChannelInfo = function (meta)\n  {\n    if (this.changeCallback)\n    {\n      this.changeCallback();\n    }\n  };\n\n  function getWriterInfo()\n  {\n    var ids = roomInfo.channel.writers.user_ids;\n    if (ids)\n    {\n      appnet.api.getUserList(ids, null, completeWriterInfo, failWriterInfo);\n    }\n    else if (roomInfo.changecallback)\n    {\n      roomInfo.changeCallback();\n    }\n  }\n\n  function completeWriterInfo(response)\n  {\n    var i = 0;\n    for (i = 0; i < response.data.length; i += 1)\n    {\n      roomInfo.members[response.data[i].username] = response.data[i];\n    }\n\n    if (roomInfo.changeCallback)\n    {\n      roomInfo.changeCallback();\n    }\n  }\n\n  function failWriterInfo(response)\n  {\n    if (roomInfo.changeCallback)\n    {\n      roomInfo.changeCallback();\n    }\n  }\n\n  return roomInfo;\n});\n\n//@ sourceURL=/js/roomInfo.js");

eval("// UserFields.js\n//\n// Expandable list of input fields which are validated against app.net\n\n/*global define:true */\ndefine(\'js/UserFields\',[\'jquery\', \'util\', \'appnet\'],\nfunction ($, util, appnet) {\n  \'use strict\';\n  function UserFields(prefix)\n  {\n    this.prefix = prefix;\n    this.moreDiv = $(\'#\' + prefix + \'-more-div\');\n    this.fieldCount = 0;\n    this.memberNames = {};\n    this.callback = null;\n    $(\'#\' + prefix + \'-more-button\').click($.proxy(this.clickMore, this));\n  }\n\n  UserFields.prototype.clickMore = function (event)\n  {\n    event.preventDefault();\n    this.addField();\n    return false;\n  };\n\n  // Create a new user name field\n  UserFields.prototype.addField = function (val)\n  {\n    var fieldset = $(\'<fieldset/>\');\n    var newItem = $(\'<div id=\"\' + this.prefix + \'-wrapper-\' +\n                    this.fieldCount +\n                    \'\" class=\"input-append control-group pull-left\"/>\');\n    newItem.append(\'<input id=\"\' + this.prefix + \'-input-\' + this.fieldCount +\n                   \'\" class=\"input\" type=\"text\" placeholder=\"@user\">\');\n    newItem.append(\'<button tabindex=\"-1\" id=\"\' + this.prefix + \'-remove-\' +\n                   this.fieldCount +\n                   \'\" class=\"btn btn-danger\"><i class=\"icon-remove\"></i></button>\');\n    fieldset.append(newItem);\n    this.moreDiv.before(fieldset);\n    if (val) {\n      $(\'#\' + this.prefix + \'-input-\' + this.fieldCount).val(val);\n    }\n    $(\'#\' + this.prefix + \'-remove-\' + this.fieldCount).on(\'click\', null, { index: this.fieldCount, obj: this }, function (event) {\n      event.preventDefault();\n      event.data.obj.removeField(event.data.index);\n      return false;\n    });\n    this.fieldCount += 1;\n  };\n\n  // Remove a new user name field\n  UserFields.prototype.removeField = function (index)\n  {\n    var i = 0;\n    if (index >= 0 && index < this.fieldCount) {\n      $(\'#\' + this.prefix + \'-wrapper-\' + index).remove();\n      var vals = [];\n      for (i = index + 1; i < this.fieldCount; i += 1)\n      {\n        vals.push($(\'#\' + this.prefix + \'-input-\' + i).val());\n        $(\'#\' + this.prefix + \'-wrapper-\' + i).remove();\n      }\n      this.fieldCount = index;\n      for (i = 0; i < vals.length; i += 1)\n      {\n        this.addField(vals[i]);\n      }\n    }\n  };\n\n  // Check validity of names, mark invalid names, then callback with a\n  // list of names or an empty list on failure.\n  UserFields.prototype.checkNames = function (callback)\n  {\n    this.callback = callback;\n    this.memberNames = {};\n    var foundName = false;\n    var i = 0;\n    for (i = 0; i < this.fieldCount; i += 1) {\n      var newName = $(\'#\' + this.prefix + \'-input-\' + i).val();\n      if (newName.substr(0, 1) !== \'@\')\n      {\n        newName = \'@\' + newName;\n      }\n      if (newName !== \'\' && newName !== \'@\')\n      {\n        this.memberNames[newName] = i;\n        foundName = true;\n      }\n    }\n    if (foundName)\n    {\n      appnet.api.getUserList(Object.keys(this.memberNames),\n                             { include_annotations: 1 },\n                             $.proxy(this.processNames, this),\n                             $.proxy(this.failNames, this));\n    }\n    else\n    {\n      this.callback([]);\n    }\n  };\n\n  UserFields.prototype.failNames = function (response)\n  {\n    util.flagError(this.prefix + \'-error-div\',\n                   \'Could not connect to app.net\');\n    if (this.callback)\n    {\n      this.callback(null);\n    }\n  };\n\n  UserFields.prototype.processNames = function (response)\n  {\n    var validNames = {};\n    var i = 0;\n    for (i = 0; i < response.data.length; i += 1)\n    {\n      validNames[\'@\' + response.data[i].username] = 1;\n    }\n    var keys = Object.keys(this.memberNames);\n    var allOk = true;\n    for (i = 0; i < keys.length; i += 1)\n    {\n      var index = this.memberNames[keys[i]];\n      $(\'#\' + this.prefix + \'-wrapper-\' + index).removeClass(\'error\');\n      if (validNames[keys[i]] === undefined)\n      {\n        allOk = false;\n        $(\'#\' + this.prefix + \'-wrapper-\' + index).addClass(\'error\');\n      }\n    }\n    var callbackArray = null;\n    if (allOk)\n    {\n      callbackArray = keys;\n    }\n    else\n    {\n      util.flagError(this.prefix + \'-error-div\',\n                     \'Fix Invalid Usernames\');\n    }\n    if (this.callback)\n    {\n      this.callback(callbackArray);\n    }\n  };\n\n  UserFields.prototype.hide = function ()\n  {\n    var i = 0;\n    $(\'#\' + this.prefix + \'-more-button\').hide();\n    $(\'#\' + this.prefix + \'-more-div\').hide();\n    for (i = 0; i < this.fieldCount; i += 1) {\n      $(\'#\' + this.prefix + \'-wrapper-\' + i).hide();\n    }\n  };\n\n  UserFields.prototype.show = function ()\n  {\n    var i = 0;\n    $(\'#\' + this.prefix + \'-more-button\').show();\n    $(\'#\' + this.prefix + \'-more-div\').show();\n    for (i = 0; i < this.fieldCount; i += 1) {\n      $(\'#\' + this.prefix + \'-wrapper-\' + i).show();\n    }\n  };\n\n  UserFields.prototype.disable = function ()\n  {\n    var i = 0;\n    $(\'#\' + this.prefix + \'-more-button\').hide();\n    for (i = 0; i < this.fieldCount; i += 1) {\n      $(\'#\' + this.prefix + \'-input-\' + i).attr(\'disabled\', true);\n      $(\'#\' + this.prefix + \'-remove-\' + i).hide();\n    }\n  };\n\n  UserFields.prototype.enable = function ()\n  {\n    var i = 0;\n    $(\'#\' + this.prefix + \'-more-button\').show();\n    for (i = 0; i < this.fieldCount; i += 1) {\n      $(\'#\' + this.prefix + \'-input-\' + i).attr(\'disabled\', false);\n      $(\'#\' + this.prefix + \'-remove-\' + i).show();\n    }\n  };\n\n  UserFields.prototype.reset = function ()\n  {\n    this.enable();\n    while (this.fieldCount > 0) {\n      this.removeField(this.fieldCount - 1);\n    }\n  };\n\n  return UserFields;\n});\n\n//@ sourceURL=/js/UserFields.js");

eval("/**\n * @license RequireJS text 2.0.3 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.\n * Available via the MIT or new BSD license.\n * see: http://github.com/requirejs/text for details\n */\n/*jslint regexp: true */\n/*global require: false, XMLHttpRequest: false, ActiveXObject: false,\n  define: false, window: false, process: false, Packages: false,\n  java: false, location: false */\n\ndefine(\'text\',[\'module\'], function (module) {\n    \'use strict\';\n\n    var text, fs,\n        progIds = [\'Msxml2.XMLHTTP\', \'Microsoft.XMLHTTP\', \'Msxml2.XMLHTTP.4.0\'],\n        xmlRegExp = /^\\s*<\\?xml(\\s)+version=[\\\'\\\"](\\d)*.(\\d)*[\\\'\\\"](\\s)*\\?>/im,\n        bodyRegExp = /<body[^>]*>\\s*([\\s\\S]+)\\s*<\\/body>/im,\n        hasLocation = typeof location !== \'undefined\' && location.href,\n        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\\:/, \'\'),\n        defaultHostName = hasLocation && location.hostname,\n        defaultPort = hasLocation && (location.port || undefined),\n        buildMap = [],\n        masterConfig = (module.config && module.config()) || {};\n\n    text = {\n        version: \'2.0.3\',\n\n        strip: function (content) {\n            //Strips <?xml ...?> declarations so that external SVG and XML\n            //documents can be added to a document without worry. Also, if the string\n            //is an HTML document, only the part inside the body tag is returned.\n            if (content) {\n                content = content.replace(xmlRegExp, \"\");\n                var matches = content.match(bodyRegExp);\n                if (matches) {\n                    content = matches[1];\n                }\n            } else {\n                content = \"\";\n            }\n            return content;\n        },\n\n        jsEscape: function (content) {\n            return content.replace(/([\'\\\\])/g, \'\\\\$1\')\n                .replace(/[\\f]/g, \"\\\\f\")\n                .replace(/[\\b]/g, \"\\\\b\")\n                .replace(/[\\n]/g, \"\\\\n\")\n                .replace(/[\\t]/g, \"\\\\t\")\n                .replace(/[\\r]/g, \"\\\\r\")\n                .replace(/[\\u2028]/g, \"\\\\u2028\")\n                .replace(/[\\u2029]/g, \"\\\\u2029\");\n        },\n\n        createXhr: masterConfig.createXhr || function () {\n            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.\n            var xhr, i, progId;\n            if (typeof XMLHttpRequest !== \"undefined\") {\n                return new XMLHttpRequest();\n            } else if (typeof ActiveXObject !== \"undefined\") {\n                for (i = 0; i < 3; i += 1) {\n                    progId = progIds[i];\n                    try {\n                        xhr = new ActiveXObject(progId);\n                    } catch (e) {}\n\n                    if (xhr) {\n                        progIds = [progId];  // so faster next time\n                        break;\n                    }\n                }\n            }\n\n            return xhr;\n        },\n\n        /**\n         * Parses a resource name into its component parts. Resource names\n         * look like: module/name.ext!strip, where the !strip part is\n         * optional.\n         * @param {String} name the resource name\n         * @returns {Object} with properties \"moduleName\", \"ext\" and \"strip\"\n         * where strip is a boolean.\n         */\n        parseName: function (name) {\n            var strip = false, index = name.indexOf(\".\"),\n                modName = name.substring(0, index),\n                ext = name.substring(index + 1, name.length);\n\n            index = ext.indexOf(\"!\");\n            if (index !== -1) {\n                //Pull off the strip arg.\n                strip = ext.substring(index + 1, ext.length);\n                strip = strip === \"strip\";\n                ext = ext.substring(0, index);\n            }\n\n            return {\n                moduleName: modName,\n                ext: ext,\n                strip: strip\n            };\n        },\n\n        xdRegExp: /^((\\w+)\\:)?\\/\\/([^\\/\\\\]+)/,\n\n        /**\n         * Is an URL on another domain. Only works for browser use, returns\n         * false in non-browser environments. Only used to know if an\n         * optimized .js version of a text resource should be loaded\n         * instead.\n         * @param {String} url\n         * @returns Boolean\n         */\n        useXhr: function (url, protocol, hostname, port) {\n            var uProtocol, uHostName, uPort,\n                match = text.xdRegExp.exec(url);\n            if (!match) {\n                return true;\n            }\n            uProtocol = match[2];\n            uHostName = match[3];\n\n            uHostName = uHostName.split(\':\');\n            uPort = uHostName[1];\n            uHostName = uHostName[0];\n\n            return (!uProtocol || uProtocol === protocol) &&\n                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&\n                   ((!uPort && !uHostName) || uPort === port);\n        },\n\n        finishLoad: function (name, strip, content, onLoad) {\n            content = strip ? text.strip(content) : content;\n            if (masterConfig.isBuild) {\n                buildMap[name] = content;\n            }\n            onLoad(content);\n        },\n\n        load: function (name, req, onLoad, config) {\n            //Name has format: some.module.filext!strip\n            //The strip part is optional.\n            //if strip is present, then that means only get the string contents\n            //inside a body tag in an HTML string. For XML/SVG content it means\n            //removing the <?xml ...?> declarations so the content can be inserted\n            //into the current doc without problems.\n\n            // Do not bother with the work if a build and text will\n            // not be inlined.\n            if (config.isBuild && !config.inlineText) {\n                onLoad();\n                return;\n            }\n\n            masterConfig.isBuild = config.isBuild;\n\n            var parsed = text.parseName(name),\n                nonStripName = parsed.moduleName + \'.\' + parsed.ext,\n                url = req.toUrl(nonStripName),\n                useXhr = (masterConfig.useXhr) ||\n                         text.useXhr;\n\n            //Load the text. Use XHR if possible and in a browser.\n            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {\n                text.get(url, function (content) {\n                    text.finishLoad(name, parsed.strip, content, onLoad);\n                }, function (err) {\n                    if (onLoad.error) {\n                        onLoad.error(err);\n                    }\n                });\n            } else {\n                //Need to fetch the resource across domains. Assume\n                //the resource has been optimized into a JS module. Fetch\n                //by the module name + extension, but do not include the\n                //!strip part to avoid file system issues.\n                req([nonStripName], function (content) {\n                    text.finishLoad(parsed.moduleName + \'.\' + parsed.ext,\n                                    parsed.strip, content, onLoad);\n                });\n            }\n        },\n\n        write: function (pluginName, moduleName, write, config) {\n            if (buildMap.hasOwnProperty(moduleName)) {\n                var content = text.jsEscape(buildMap[moduleName]);\n                write.asModule(pluginName + \"!\" + moduleName,\n                               \"define(function () { return \'\" +\n                                   content +\n                               \"\';});\\n\");\n            }\n        },\n\n        writeFile: function (pluginName, moduleName, req, write, config) {\n            var parsed = text.parseName(moduleName),\n                nonStripName = parsed.moduleName + \'.\' + parsed.ext,\n                //Use a \'.js\' file name so that it indicates it is a\n                //script that can be loaded across domains.\n                fileName = req.toUrl(parsed.moduleName + \'.\' +\n                                     parsed.ext) + \'.js\';\n\n            //Leverage own load() method to load plugin value, but only\n            //write out values that do not have the strip argument,\n            //to avoid any potential issues with ! in file names.\n            text.load(nonStripName, req, function (value) {\n                //Use own write() method to construct full module value.\n                //But need to create shell that translates writeFile\'s\n                //write() to the right interface.\n                var textWrite = function (contents) {\n                    return write(fileName, contents);\n                };\n                textWrite.asModule = function (moduleName, contents) {\n                    return write.asModule(moduleName, fileName, contents);\n                };\n\n                text.write(pluginName, nonStripName, textWrite, config);\n            }, config);\n        }\n    };\n\n    if (masterConfig.env === \'node\' || (!masterConfig.env &&\n            typeof process !== \"undefined\" &&\n            process.versions &&\n            !!process.versions.node)) {\n        //Using special require.nodeRequire, something added by r.js.\n        fs = require.nodeRequire(\'fs\');\n\n        text.get = function (url, callback) {\n            var file = fs.readFileSync(url, \'utf8\');\n            //Remove BOM (Byte Mark Order) from utf8 files if it is there.\n            if (file.indexOf(\'\\uFEFF\') === 0) {\n                file = file.substring(1);\n            }\n            callback(file);\n        };\n    } else if (masterConfig.env === \'xhr\' || (!masterConfig.env &&\n            text.createXhr())) {\n        text.get = function (url, callback, errback) {\n            var xhr = text.createXhr();\n            xhr.open(\'GET\', url, true);\n\n            //Allow overrides specified in config\n            if (masterConfig.onXhr) {\n                masterConfig.onXhr(xhr, url);\n            }\n\n            xhr.onreadystatechange = function (evt) {\n                var status, err;\n                //Do not explicitly handle errors, those should be\n                //visible via console output in the browser.\n                if (xhr.readyState === 4) {\n                    status = xhr.status;\n                    if (status > 399 && status < 600) {\n                        //An http 4xx or 5xx error. Signal an error.\n                        err = new Error(url + \' HTTP status: \' + status);\n                        err.xhr = xhr;\n                        errback(err);\n                    } else {\n                        callback(xhr.responseText);\n                    }\n                }\n            };\n            xhr.send(null);\n        };\n    } else if (masterConfig.env === \'rhino\' || (!masterConfig.env &&\n            typeof Packages !== \'undefined\' && typeof java !== \'undefined\')) {\n        //Why Java, why is this so awkward?\n        text.get = function (url, callback) {\n            var stringBuffer, line,\n                encoding = \"utf-8\",\n                file = new java.io.File(url),\n                lineSeparator = java.lang.System.getProperty(\"line.separator\"),\n                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),\n                content = \'\';\n            try {\n                stringBuffer = new java.lang.StringBuffer();\n                line = input.readLine();\n\n                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324\n                // http://www.unicode.org/faq/utf_bom.html\n\n                // Note that when we use utf-8, the BOM should appear as \"EF BB BF\", but it doesn\'t due to this bug in the JDK:\n                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058\n                if (line && line.length() && line.charAt(0) === 0xfeff) {\n                    // Eat the BOM, since we\'ve already found the encoding on this file,\n                    // and we plan to concatenating this buffer with others; the BOM should\n                    // only appear at the top of a file.\n                    line = line.substring(1);\n                }\n\n                stringBuffer.append(line);\n\n                while ((line = input.readLine()) !== null) {\n                    stringBuffer.append(lineSeparator);\n                    stringBuffer.append(line);\n                }\n                //Make sure we return a JavaScript string and not a Java string.\n                content = String(stringBuffer.toString()); //String\n            } finally {\n                input.close();\n            }\n            callback(content);\n        };\n    }\n\n    return text;\n});\n\n//@ sourceURL=/text.js");

eval("define(\'text!template/editRoomModal.html\',[],function () { return \'<div id=\"edit-room-modal\" class=\"modal hide fade\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"editRoomModalLabel\" aria-hidden=\"true\">\\r\\n  <div class=\"modal-header\">\\r\\n    <button id=\"edit-room-x\" type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">&times;</button>\\r\\n    <h3 id=\"edit-room-type\">Edit Room</h3>\\r\\n    <h4 id=\"edit-room-owner\">Owned by @user</h4>\\r\\n  </div>\\r\\n  <div class=\"modal-body\">\\r\\n    <p id=\"edit-room-body\">Main body text</p>\\r\\n    <form id=\"edit-room-form\">\\r\\n      <fieldset>\\r\\n        <input type=\"text\" placeholder=\"Name\" id=\"edit-room-name\">\\r\\n      </fieldset>\\r\\n      <fieldset>\\r\\n        <textarea id=\"edit-room-text\" class=\"input-xlarge\"\\r\\n                  rows=\"3\" maxlength=\"256\"\\r\\n                  placeholder=\"Private Message...\"></textarea>\\r\\n      </fieldset>\\r\\n      <fieldset>\\r\\n        <select id=\"edit-room-perm\" class=\"input-medium\">\\r\\n          <option value=\"private\">Private</option>\\r\\n          <option value=\"public\">Public</option>\\r\\n          <option value=\"public-read\">Public Read</option>\\r\\n        </select>\\r\\n        <label id=\"edit-room-perm-label\"></label>\\r\\n      </fieldset>\\r\\n      <fieldset id=\"edit-room-promote-wrapper\">\\r\\n        <label class=\"checkbox\">\\r\\n          <input type=\"checkbox\" id=\"edit-room-promote\">Show this room in the Patter Directory</input>\\r\\n        </label>\\r\\n        <fieldset id=\"edit-room-promo-options\">\\r\\n          <textarea id=\"edit-room-promo-text\" class=\"input-xlarge\"\\r\\n                    rows=\"3\" maxlength=\"256\"\\r\\n                    placeholder=\"Describe Your Room...\"></textarea>\\r\\n          <label class=\"checkbox\">\\r\\n            <input type=\"checkbox\" id=\"edit-fun\">Fun</input>\\r\\n          </label>\\r\\n          <label class=\"checkbox\">\\r\\n            <input type=\"checkbox\" id=\"edit-lifestyle\">Lifestyle</input>\\r\\n          </label>\\r\\n          <label class=\"checkbox\">\\r\\n            <input type=\"checkbox\" id=\"edit-profession\">Professional</input>\\r\\n          </label>\\r\\n          <label class=\"checkbox\">\\r\\n            <input type=\"checkbox\" id=\"edit-language\">Language/Region</input>\\r\\n          </label>\\r\\n          <label class=\"checkbox\">\\r\\n            <input type=\"checkbox\" id=\"edit-community\">Community</input>\\r\\n          </label>\\r\\n          <label class=\"checkbox\">\\r\\n            <input type=\"checkbox\" id=\"edit-tech\">Tech</input>\\r\\n          </label>\\r\\n          <label class=\"checkbox\">\\r\\n            <input type=\"checkbox\" id=\"edit-event\">Event</input>\\r\\n          </label>\\r\\n        </fieldset>\\r\\n      </fieldset>\\r\\n      <div class=\"row-fluid\">\\r\\n        <div class=\"span6\">\\r\\n          <div id=\"edit-room-more-div\" style=\"clear: both;\"></div>\\r\\n        </div>\\r\\n        <div class=\"span1\">\\r\\n          <button class=\"btn btn-success\" id=\"edit-room-more-button\"><i class=\"icon-plus\"></i></button>\\r\\n        </div>\\r\\n      </div>\\r\\n      <div id=\"edit-room-error-div\"></div>\\r\\n    </form>\\r\\n  </div>\\r\\n  <div class=\"modal-footer\">\\r\\n    <button id=\"edit-room-cancel\" class=\"btn\" data-dismiss=\"modal\" aria-hidden=\"true\">Cancel</button>\\r\\n    <button id=\"edit-room-save\" data-dismiss=\"modal\" data-loading-text=\"Saving...\" class=\"btn btn-primary\">Save</button>\\r\\n  </div>\\r\\n</div>\\r\\n\';});\n\n//@ sourceURL=/text!template/editRoomModal.html");

/*!
* Bootstrap.js by @fat & @mdo
* Copyright 2012 Twitter, Inc.
* http://www.apache.org/licenses/LICENSE-2.0.txt
*/
!function(e){e(function(){e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},n;for(n in t)if(e.style[n]!==undefined)return t[n]}();return e&&{end:e}}()})}(window.jQuery),!function(e){var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function s(){i.trigger("closed").remove()}var n=e(this),r=n.attr("data-target"),i;r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),i=e(r),t&&t.preventDefault(),i.length||(i=n.hasClass("alert")?n:n.parent()),i.trigger(t=e.Event("close"));if(t.isDefaultPrevented())return;i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.on(e.support.transition.end,s):s()},e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("alert");i||r.data("alert",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.alert.Constructor=n,e(function(){e("body").on("click.alert.data-api",t,n.prototype.close)})}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.button.defaults,n)};t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text",r.resetText||n.data("resetText",n[i]()),n[i](r[e]||this.options[e]),setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active"),this.$element.toggleClass("active")},e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s=typeof n=="object"&&n;i||r.data("button",i=new t(this,s)),n=="toggle"?i.toggle():n&&i.setState(n)})},e.fn.button.defaults={loadingText:"loading..."},e.fn.button.Constructor=t,e(function(){e("body").on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle")})})}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=n,this.options.slide&&this.slide(this.options.slide),this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){return t||(this.paused=!1),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},to:function(t){var n=this.$element.find(".item.active"),r=n.parent().children(),i=r.index(n),s=this;if(t>r.length-1||t<0)return;return this.sliding?this.$element.one("slid",function(){s.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",e(r[t]))},pause:function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle()),clearInterval(this.interval),this.interval=null,this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",a=this,f=e.Event("slide",{relatedTarget:i[0]});this.sliding=!0,s&&this.pause(),i=i.length?i:this.$element.find(".item")[u]();if(i.hasClass("active"))return;if(e.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(f);if(f.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),this.$element.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger("slid")},0)})}else{this.$element.trigger(f);if(f.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}},e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=e.extend({},e.fn.carousel.defaults,typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;i||r.data("carousel",i=new t(this,s)),typeof n=="number"?i.to(n):o?i[o]():s.interval&&i.cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e(function(){e("body").on("click.carousel.data-api","[data-slide]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=!i.data("modal")&&e.extend({},i.data(),n.data());i.carousel(s),t.preventDefault()})})}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.collapse.defaults,n),this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var e=this.$element.hasClass("width");return e?"width":"height"},show:function(){var t,n,r,i;if(this.transitioning)return;t=this.dimension(),n=e.camelCase(["scroll",t].join("-")),r=this.$parent&&this.$parent.find("> .accordion-group > .in");if(r&&r.length){i=r.data("collapse");if(i&&i.transitioning)return;r.collapse("hide"),i||r.data("collapse",null)}this.$element[t](0),this.transition("addClass",e.Event("show"),"shown"),e.support.transition&&this.$element[t](this.$element[0][n])},hide:function(){var t;if(this.transitioning)return;t=this.dimension(),this.reset(this.$element[t]()),this.transition("removeClass",e.Event("hide"),"hidden"),this.$element[t](0)},reset:function(e){var t=this.dimension();return this.$element.removeClass("collapse")[t](e||"auto")[0].offsetWidth,this.$element[e!==null?"addClass":"removeClass"]("collapse"),this},transition:function(t,n,r){var i=this,s=function(){n.type=="show"&&i.reset(),i.transitioning=0,i.$element.trigger(r)};this.$element.trigger(n);if(n.isDefaultPrevented())return;this.transitioning=1,this.$element[t]("in"),e.support.transition&&this.$element.hasClass("collapse")?this.$element.one(e.support.transition.end,s):s()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}},e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("collapse"),s=typeof n=="object"&&n;i||r.data("collapse",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.collapse.defaults={toggle:!0},e.fn.collapse.Constructor=t,e(function(){e("body").on("click.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i).data("collapse")?"toggle":n.data();n[e(i).hasClass("in")?"addClass":"removeClass"]("collapsed"),e(i).collapse(s)})})}(window.jQuery),!function(e){function r(){i(e(t)).removeClass("open")}function i(t){var n=t.attr("data-target"),r;return n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,"")),r=e(n),r.length||(r=t.parent()),r}var t="[data-toggle=dropdown]",n=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};n.prototype={constructor:n,toggle:function(t){var n=e(this),s,o;if(n.is(".disabled, :disabled"))return;return s=i(n),o=s.hasClass("open"),r(),o||(s.toggleClass("open"),n.focus()),!1},keydown:function(t){var n,r,s,o,u,a;if(!/(38|40|27)/.test(t.keyCode))return;n=e(this),t.preventDefault(),t.stopPropagation();if(n.is(".disabled, :disabled"))return;o=i(n),u=o.hasClass("open");if(!u||u&&t.keyCode==27)return n.click();r=e("[role=menu] li:not(.divider) a",o);if(!r.length)return;a=r.index(r.filter(":focus")),t.keyCode==38&&a>0&&a--,t.keyCode==40&&a<r.length-1&&a++,~a||(a=0),r.eq(a).focus()}},e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("dropdown");i||r.data("dropdown",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.dropdown.Constructor=n,e(function(){e("html").on("click.dropdown.data-api touchstart.dropdown.data-api",r),e("body").on("click.dropdown touchstart.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",t,n.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",t+", [role=menu]",n.prototype.keydown)})}(window.jQuery),!function(e){var t=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n);if(this.isShown||n.isDefaultPrevented())return;e("body").addClass("modal-open"),this.isShown=!0,this.escape(),this.backdrop(function(){var n=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1).focus(),t.enforceFocus(),n?t.$element.one(e.support.transition.end,function(){t.$element.trigger("shown")}):t.$element.trigger("shown")})},hide:function(t){t&&t.preventDefault();var n=this;t=e.Event("hide"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,e("body").removeClass("modal-open"),this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]!==e.target&&!t.$element.has(e.target).length&&t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){t.which==27&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n),t.hideModal()})},hideModal:function(e){this.$element.hide().trigger("hidden"),this.backdrop()},removeBackdrop:function(){this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.options.backdrop!="static"&&this.$backdrop.click(e.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),i?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,e.proxy(this.removeBackdrop,this)):this.removeBackdrop()):t&&t()}},e.fn.modal=function(n){return this.each(function(){var r=e(this),i=r.data("modal"),s=e.extend({},e.fn.modal.defaults,r.data(),typeof n=="object"&&n);i||r.data("modal",i=new t(this,s)),typeof n=="string"?i[n]():s.show&&i.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e(function(){e("body").on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s).one("hide",function(){n.focus()})})})}(window.jQuery),!function(e){var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s;this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,this.options.trigger=="click"?this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this)):this.options.trigger!="manual"&&(i=this.options.trigger=="hover"?"mouseenter":"focus",s=this.options.trigger=="hover"?"mouseleave":"blur",this.$element.on(i+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,e.proxy(this.leave,this))),this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);if(!n.options.delay||!n.options.delay.show)return n.show();clearTimeout(this.timeout),n.hoverState="in",this.timeout=setTimeout(function(){n.hoverState=="in"&&n.show()},n.options.delay.show)},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!n.options.delay||!n.options.delay.hide)return n.hide();n.hoverState="out",this.timeout=setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide)},show:function(){var e,t,n,r,i,s,o;if(this.hasContent()&&this.enabled){e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),s=typeof this.options.placement=="function"?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,t=/in/.test(s),e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body),n=this.getPosition(t),r=e[0].offsetWidth,i=e[0].offsetHeight;switch(t?s.split(" ")[1]:s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}e.css(o).addClass(s).addClass("in")}},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function r(){var t=setTimeout(function(){n.off(e.support.transition.end).remove()},500);n.one(e.support.transition.end,function(){clearTimeout(t),n.remove()})}var t=this,n=this.tip();return n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?r():n.remove(),this},fixTitle:function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}},e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s=typeof n=="object"&&n;i||r.data("tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:!0}}(window.jQuery),!function(e){var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content > *")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-content")||(typeof n.content=="function"?n.content.call(t[0]):n.content),e},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}}),e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s=typeof n=="object"&&n;i||r.data("popover",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery),!function(e){function t(t,n){var r=e.proxy(this.process,this),i=e(t).is("body")?e(window):e(t),s;this.options=e.extend({},e.fn.scrollspy.defaults,n),this.$scrollElement=i.on("scroll.scroll-spy.data-api",r),this.selector=(this.options.target||(s=e(t).attr("href"))&&s.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=e("body"),this.refresh(),this.process()}t.prototype={constructor:t,refresh:function(){var t=this,n;this.offsets=e([]),this.targets=e([]),n=this.$body.find(this.selector).map(function(){var t=e(this),n=t.data("target")||t.attr("href"),r=/^#\w/.test(n)&&e(n);return r&&r.length&&[[r.position().top,n]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},process:function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget,o;if(e>=n)return s!=(o=i.last()[0])&&this.activate(o);for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])},activate:function(t){var n,r;this.activeTarget=t,e(this.selector).parent(".active").removeClass("active"),r=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',n=e(r).parent("li").addClass("active"),n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate")}},e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("scrollspy"),s=typeof n=="object"&&n;i||r.data("scrollspy",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.defaults={offset:10},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),!function(e){var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s,o;r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;i=n.find(".active a").last()[0],o=e.Event("show",{relatedTarget:i}),t.trigger(o);if(o.isDefaultPrevented())return;s=e(r),this.activate(t.parent("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o(),i.removeClass("in")}},e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e(function(){e("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})})}(window.jQuery),!function(e){var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.$menu=e(this.options.menu).appendTo("body"),this.source=this.options.source,this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:t.top+t.height,left:t.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){var n;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(n=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,n?this.process(n):this)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var t=[],n=[],r=[],i;while(i=e.shift())i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?n.push(i):r.push(i):t.push(i);return t.concat(n,r)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),(e.browser.chrome||e.browser.webkit||e.browser.msie)&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this))},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()},keydown:function(t){this.suppressKeyPressRepeat=!~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},blur:function(e){var t=this;setTimeout(function(){t.hide()},150)},click:function(e){e.stopPropagation(),e.preventDefault(),this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")}},e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n=="object"&&n;i||r.data("typeahead",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e(function(){e("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;t.preventDefault(),n.typeahead(n.data())})})}(window.jQuery),!function(e){var t=function(t,n){this.options=e.extend({},e.fn.affix.defaults,n),this.$window=e(window).on("scroll.affix.data-api",e.proxy(this.checkPosition,this)),this.$element=e(t),this.checkPosition()};t.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var t=e(document).height(),n=this.$window.scrollTop(),r=this.$element.offset(),i=this.options.offset,s=i.bottom,o=i.top,u="affix affix-top affix-bottom",a;typeof i!="object"&&(s=o=i),typeof o=="function"&&(o=i.top()),typeof s=="function"&&(s=i.bottom()),a=this.unpin!=null&&n+this.unpin<=r.top?!1:s!=null&&r.top+this.$element.height()>=t-s?"bottom":o!=null&&n<=o?"top":!1;if(this.affixed===a)return;this.affixed=a,this.unpin=a=="bottom"?r.top-n:null,this.$element.removeClass(u).addClass("affix"+(a?"-"+a:""))},e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("affix"),s=typeof n=="object"&&n;i||r.data("affix",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.affix.Constructor=t,e.fn.affix.defaults={offset:0},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),t.affix(n)})})}(window.jQuery);
define("bootstrap", function(){});

eval("// editRoomModal.js\n//\n// A dialog box for editing or viewing the properties of the current\n// room. This may also be used as a dialog for creating a new room.\n\n/*global define:true */\ndefine(\'js/editRoomModal\',[\'jquery\', \'util\', \'appnet\', \'js/roomInfo\',\n        \'js/UserFields\',\n        \'text!template/editRoomModal.html\', \'bootstrap\'],\nfunction ($, util, appnet, roomInfo, UserFields, editTemplate) {\n  \'use strict\';\n\n  var categories = [\'fun\', \'lifestyle\', \'profession\', \'language\',\n                    \'community\', \'tech\', \'event\'];\n\n  var editRoomModal = {\n  };\n\n  var editRoomFields = null;\n  var editRoomChannel = null;\n  var editRoomType = null;\n\n  editRoomModal.init = function ()\n  {\n    $(\'#modal-container\').append(editTemplate);\n    editRoomFields = new UserFields(\'edit-room\');\n    $(\'#edit-room-save\').click(clickSave);\n    $(\'#edit-room-perm\').on(\'change\', function (event) {\n      updatePatterPerm();\n    });\n    $(\'#edit-room-promote\').on(\'change\', function (event) {\n      updatePatterPerm();\n    });\n    $(\'#edit-room-form\').on(\'submit\', function (event) {\n      event.preventDefault();\n      $(\'#edit-room-save\').click();\n      return false;\n    });\n  };\n\n  editRoomModal.show = function ()\n  {\n    $(\'#edit-room-modal\').modal();\n  };\n\n  editRoomModal.canEditChannel = function (channel) {\n    return channel.you_can_edit &&\n      (channel.type === \'net.patter-app.room\' ||\n       ! channel.writers.immutable ||\n       ! channel.readers.immutable);\n  };\n\n  editRoomModal.update = function (newChannel, newType)\n  {\n    var i = 0;\n    var j = 0;\n    editRoomChannel = newChannel;\n    editRoomType = newType;\n    var canEdit = true;\n    if (editRoomChannel !== null) {\n      canEdit = this.canEditChannel(editRoomChannel);\n      editRoomType = editRoomChannel.type;\n    }\n    var settings = appnet.note.findPatterSettings(editRoomChannel);\n\n    // Modal Title\n    var roomType = \'Create \';\n    if (editRoomChannel !== null && canEdit) {\n      roomType = \'Edit \';\n    } else if (editRoomChannel !== null) {\n      roomType = \'View \';\n    }\n    if (editRoomType === \'net.patter-app.room\') {\n      roomType += \'Patter Room\';\n    } else if (editRoomType === \'net.app.core.pm\') {\n      roomType += \'PM Channel\';\n    }\n    $(\'#edit-room-type\').html(roomType);\n    \n    // Modal subtitle\n    var ownerText = \'\';\n    if (editRoomChannel !== null) {\n      ownerText = \'Owned by @\' + editRoomChannel.owner.username;\n    }\n    $(\'#edit-room-owner\').html(ownerText);\n    \n    $(\'#edit-room-body\').hide();\n    if (editRoomChannel === null) {\n      if (editRoomType === \'net.patter-app.room\') {\n        $(\'#edit-room-body\').html(\'Patter rooms may be public or private and the owner can modify permissions after they are created.\');\n        $(\'#edit-room-body\').show();\n      } else if (editRoomType === \'net.app.core.pm\') {\n        $(\'#edit-room-body\').html(\'Private message channels are always private, and you cannot change their permissions.\');\n        $(\'#edit-room-body\').show();\n      }\n    }\n\n    // Set name field\n    if (editRoomType === \'net.patter-app.room\') {\n      $(\'#edit-room-name\').show();\n    } else {\n      $(\'#edit-room-name\').hide();\n    }\n    \n    $(\'#edit-room-text\').val(\'\');\n    if (editRoomChannel === null && editRoomType === \'net.app.core.pm\') {\n      $(\'#edit-room-text\').show();\n    } else {\n      $(\'#edit-room-text\').hide();\n    }\n\n    $(\'#edit-room-perm\').removeAttr(\'disabled\');\n    if (editRoomType === \'net.app.core.pm\') {\n      $(\'#edit-room-perm\').attr(\'disabled\', true);\n      $(\'#edit-room-perm\').val(\'private\');\n    } else if (editRoomChannel !== null &&\n               (editRoomChannel.writers[\'public\'] ||\n                editRoomChannel.writers.any_user)) {\n      $(\'#edit-room-perm\').val(\'public\');\n    } else if (editRoomChannel !== null &&\n               (editRoomChannel.readers[\'public\'] ||\n                editRoomChannel.readers.any_user)) {\n      $(\'#edit-room-perm\').val(\'public-read\');\n    } else {\n      $(\'#edit-room-perm\').val(\'private\');\n    }\n\n    if (settings.name)\n    {\n      $(\'#edit-room-name\').val(settings.name);\n    }\n    else\n    {\n      $(\'#edit-room-name\').val(\'\');\n    }\n\n    if (settings.blurb && settings.blurb_id)\n    {\n      $(\'#edit-room-promo-text\').val(settings.blurb);\n      $(\'#edit-room-promote\').attr(\'checked\', \'checked\');\n    }\n    else\n    {\n      $(\'#edit-room-promo-text\').val(\'\');\n      $(\'#edit-room-promote\').removeAttr(\'checked\');\n    }\n\n    if (settings.categories)\n    {\n      for (i = 0; i < categories.length; i += 1)\n      {\n        $(\'#edit-\' + categories[i]).removeAttr(\'checked\');\n      }\n\n      for (i = 0; i < settings.categories.length; i += 1)\n      {\n        for (j = 0; j < categories.length; j += 1)\n        {\n          if (settings.categories[i] === categories[j])\n          {\n            $(\'#edit-\' + categories[j]).attr(\'checked\', \'checked\');\n          }\n        }\n      }\n    }\n\n    editRoomFields.reset();\n    if (editRoomChannel !== null)\n    {\n      var keys = Object.keys(roomInfo.members);\n      for (i = 0; i < keys.length; i += 1) {\n        editRoomFields.addField(\'@\' + keys[i]);\n      }\n    }\n    if (canEdit) {\n      editRoomFields.addField();\n    }\n    if (canEdit) {\n      $(\'#edit-room-save\').show();\n      $(\'#edit-room-cancel\').html(\'Cancel\');\n      if (editRoomChannel !== null && editRoomChannel.writers.immutable) {\n        $(\'#edit-room-perm\').attr(\'disabled\', true);\n        editRoomFields.disable();\n      } else {\n        editRoomFields.enable();\n      }\n      if (editRoomChannel !== null && editRoomChannel.readers.immutable) {\n        $(\'#edit-room-perm\').attr(\'disabled\', true);\n      }\n    } else {\n      $(\'#edit-room-save\').hide();\n      $(\'#edit-room-cancel\').html(\'Back\');\n      $(\'#edit-room-name\').attr(\'disabled\', true);\n      $(\'#edit-room-perm\').attr(\'disabled\', true);\n      editRoomFields.disable();\n    }\n    if (editRoomChannel === null)\n    {\n      $(\'#edit-room-save\').html(\'Create\');\n    }\n    else\n    {\n      $(\'#edit-room-save\').html(\'Save\');\n    }\n    $(\'#edit-room-error-div\').html(\'\');\n    updatePatterPerm();\n  };\n\n  function completeEditRoom(names) {\n    var settings = appnet.note.findPatterSettings(editRoomChannel);\n    if (names && names.length === 0 &&\n        editRoomType === \'net.app.core.pm\') {\n      util.flagError(\'pm-create-fields-error-div\', \'You need at least one recipient\');\n    } else if (names) {\n      if (editRoomType === \'net.app.core.pm\') {\n        createPmChannel(names);\n      } else {\n        if (editRoomChannel === null) {\n          createPatterChannel(names);\n        } else {\n          if (getPromo() === \'\' || settings.blurb_id) {\n            changePatterChannel(editRoomChannel, names);\n          } else {\n            createBlurb(editRoomChannel, names);\n          }\n        }\n      }\n      $(\'#edit-room-modal\').modal(\'hide\');\n    }\n    enableEditRoom();\n  }\n\n  function disableEditRoom() {\n    $(\'#edit-room-x\').attr(\'disabled\', true);\n    $(\'#edit-room-name\').attr(\'disabled\', true);\n    $(\'#edit-room-text\').attr(\'disabled\', true);\n    $(\'#edit-room-perm\').attr(\'disabled\', true);\n    $(\'#edit-room-cancel\').attr(\'disabled\', true);\n    $(\'#edit-room-save\').button(\'loading\');\n    editRoomFields.disable();\n  }\n\n  function enableEditRoom() {\n    $(\'#edit-room-x\').removeAttr(\'disabled\');\n    $(\'#edit-room-name\').removeAttr(\'disabled\');\n    $(\'#edit-room-text\').removeAttr(\'disabled\');\n    $(\'#edit-room-perm\').removeAttr(\'disabled\');\n    $(\'#edit-room-cancel\').removeAttr(\'disabled\');\n    $(\'#edit-room-save\').button(\'reset\');\n    editRoomFields.enable();\n  }\n\n  function getPatterAccess(perm, members, oldChannel)\n  {\n    var channel = { auto_subscribe: true };\n    if (! oldChannel || ! oldChannel.writers.immutable) {\n      var canWrite = (perm === \'public\');\n      var writers = {\n        immutable: false,\n        any_user: canWrite\n      };\n      if (! canWrite)\n      {\n        writers.user_ids = members;\n      }\n      channel.writers = writers;\n    }\n    if (! oldChannel || ! oldChannel.readers.immutable) {\n      var canRead = (perm === \'public\' || perm === \'public-read\');\n      var readers = {\n        immutable: false,\n        \'public\': canRead\n      };\n      channel.readers = readers;\n    }\n\n    return channel;\n  }\n\n  function getPatterNotes(channel, name, promo, blurbId)\n  {\n    var annotations = [];\n    var settings = appnet.note.findPatterSettings(channel);\n    var cats = [];\n    var i = 0;\n    var settingsNote = {\n      type: \'net.patter-app.settings\',\n      value: { name: name }\n    };\n    if (promo === \'\' && settings.blurb_id) {\n      appnet.api.deleteMessage(\'1614\', settings.blurb_id,\n                               null, null, null);\n    } else if (promo !== \'\' && ! blurbId && settings.blurb_id) {\n      blurbId = settings.blurb_id;\n    }\n    if (blurbId) {\n      settingsNote.value.blurb_id = blurbId;\n      settingsNote.value.blurb = promo;\n      for (i = 0; i < categories.length; i += 1)\n      {\n        if ($(\'#edit-\' + categories[i]).attr(\'checked\'))\n        {\n          cats.push(categories[i]);\n        }\n      }\n      settingsNote.value.categories = cats;\n    }\n    annotations.push(settingsNote);\n    var fallback = {\n      type: \'net.app.core.fallback_url\',\n      value: {\n        url: \'http://patter-app.net/room.html?channel=\' + channel.id\n      }\n    };\n    annotations.push(fallback);\n    return annotations;\n  }\n\n  function updatePatterPerm() {\n    var perm = $(\'#edit-room-perm\');\n    var label = $(\'#edit-room-perm-label\');\n    var pwrapper = $(\'#edit-room-promote-wrapper\');\n    var pbox = $(\'#edit-room-promote\');\n    var poptions = $(\'#edit-room-promo-options\');\n    var fields = editRoomFields;\n\n    if (perm.val() === \'private\' ||\n        (editRoomChannel !== null &&\n         ! editRoomModal.canEditChannel(editRoomChannel))) {\n      pwrapper.hide();\n    } else {\n      pwrapper.show();\n    }\n\n    if (pbox.attr(\'checked\')) {\n      poptions.show();\n    } else {\n      poptions.hide();\n    }\n\n    if (perm.val() === \'public\') {\n      fields.hide();\n    } else {\n      fields.show();\n    }\n    if (perm.val() === \'private\') {\n      label.html(\'This room is private and only accessible by its members.\');\n    } else if (perm.val() === \'public\') {\n      label.html(\'This room is public and anyone may join or view it.\');\n    } else if (perm.val() === \'public-read\') {\n      label.html(\'Only members may participate, but anyone may view this room.\');\n    }\n  }\n\n  function getPromo()\n  {\n    var promo = \'\';\n    if ($(\'#edit-room-promote\').attr(\'checked\'))\n    {\n      promo = $(\'#edit-room-promo-text\').val();\n    }\n    return promo;\n  }\n\n  function changePatterChannel(oldChannel, names, blurbId, callback) {\n    if (names)\n    {\n      var success = $.proxy(roomInfo.completeChannelInfo, roomInfo);\n      if (callback)\n      {\n        success = callback;\n      }\n      var channel = getPatterAccess($(\'#edit-room-perm\').val(),\n                                    names, oldChannel);\n      channel.annotations = getPatterNotes(oldChannel,\n                                           $(\'#edit-room-name\').val(),\n                                           getPromo(), blurbId);\n      appnet.api.updateChannel(oldChannel.id, channel, {include_annotations: 1},\n                               success, null);\n      $(\'#edit-room-modal\').modal(\'hide\');\n    }\n    enableEditRoom();\n  }\n\n  function createPmChannel(names)\n  {\n    var text = $(\'#edit-room-text\').val();\n    var message = { text: text,\n                    destinations: names };\n    appnet.api.createMessage(\'pm\', message, { include_annotations: 1 },\n                             completeCreatePm, failCreatePm);\n  }\n\n  function completeCreatePm(response)\n  {\n    util.redirect(\'room.html?channel=\' + response.data.channel_id);\n  }\n\n  function failCreatePm(meta)\n  {\n    util.flagError(\'edit-room-error-div\', \'Create PM Request Failed\');\n  }\n\n  function createBlurb(channel, names, callback)\n  {\n    var name = $(\'#edit-room-name\').val();\n    var context = {\n      channel: channel,\n      names: names,\n      callback: callback\n    };\n    var message = {\n      text: getPromo(),\n      annotations: [{\n        type: \'net.app.core.channel.invite\',\n        value: {\n          \'channel_id\': channel.id\n        }\n      }]\n    };\n    appnet.api.createMessage(\'1614\', message, null,\n                             $.proxy(completeBlurb, context),\n                             failCreatePatter);\n  }\n\n  var completeBlurb = function (response)\n  {\n    changePatterChannel(this.channel, this.names, response.data.id,\n                        this.callback);\n  };\n\n  function createPatterChannel(names)\n  {\n    var context = {\n      names: names\n    };\n    var channel = {\n      type: \'net.patter-app.room\'\n    };\n    appnet.api.createChannel(channel, { include_annotations: 1 },\n                             $.proxy(completeCreatePatter, context),\n                             $.proxy(failCreatePatter, context));\n  }\n\n  var completeCreatePatter = function (response)\n  {\n    if (getPromo() === \'\') {\n      changePatterChannel(response.data, this.names, null, redirectToChannel);\n    } else {\n      createBlurb(response.data, this.names, redirectToChannel);\n    }\n  };\n\n  var failCreatePatter = function (meta)\n  {\n    if (this.blurbId)\n    {\n      appnet.api.deleteMessage(\'1614\', this.blurbId, null, null, null);\n    }\n    util.flagError(\'edit-room-error-div\', \'Create Patter Room Request Failed\');\n  };\n\n  function redirectToChannel(response)\n  {\n    util.redirect(\'room.html?channel=\' + response.data.id);\n  }\n\n  function clickSave(event) {\n    event.preventDefault();\n    if ($(\'#edit-room-name\').val() === \'\' &&\n        editRoomType === \'net.patter-app.room\') {\n      util.flagError(\'edit-room-error-div\', \'You must specify a name\');\n    } else if ($(\'#edit-room-text\').val() === \'\' &&\n               editRoomType === \'net.app.core.pm\') {\n      util.flagError(\'edit-room-error-div\', \'You must compose a message\');\n    } else {\n      disableEditRoom();\n      editRoomFields.checkNames(completeEditRoom);\n    }\n    return false;\n  }\n\n  return editRoomModal;\n});\n\n//@ sourceURL=/js/editRoomModal.js");

eval("define(\'text!template/roomMenu.html\',[],function () { return \'<div class=\"navbar-inner\">\\r\\n  <a class=\"brand patter-logo\" style=\"padding: 11px 20px 1px;\" href=\"index.html\"><img class=\"full-logo\" src=\"patter-logo.png\" width=\"70\" height=\"15\"></a>\\r\\n  <ul class=\"nav\">\\r\\n    <li><p class=\"navbar-text\" id=\"room-name\">PM</p></li>\\r\\n  </ul>\\r\\n  <p class=\"navbar-text\" id=\"room-status\">Public</p>\\r\\n  <ul class=\"nav pull-right\">\\r\\n    <li><a href=\"\" id=\"notify-button\">Enable Notify</a></li>\\r\\n    <li class=\"divider-vertical\"></li>\\r\\n    <li><a href=\"\" id=\"edit-room-button\">View Room</a></li>\\r\\n    <li class=\"divider-vertical\"></li>\\r\\n    <li><a href=\"\" id=\"subscribe-button\">Subscribe</a></li>\\r\\n    <li class=\"divider-vertical\"></li>\\r\\n    <li><a href=\"index.html\" id=\"lobby-button\">Lobby</a></li>\\r\\n  </ul>\\r\\n</div>\\r\\n\';});\n\n//@ sourceURL=/text!template/roomMenu.html");

/*
 * jQuery jFontSize Plugin
 * Examples and documentation: http://jfontsize.com
 * Author: Frederico Soares Vanelli
 *         fredsvanelli@gmail.com
 *         http://twitter.com/fredvanelli
 *         http://facebook.com/fred.vanelli
 *
 * Copyright (c) 2011
 * Version: 1.0 (2011-07-13)
 * Dual licensed under the MIT and GPL licenses.
 * http://jfontsize.com/license
 * Requires: jQuery v1.2.6 or later
 */

(function($){
    $.fn.jfontsize = function(opcoes) {
        var $this=$(this);
	    var defaults = {
		    btnMinusClasseId: '#jfontsize-minus',
		    btnDefaultClasseId: '#jfontsize-default',
		    btnPlusClasseId: '#jfontsize-plus',
            btnMinusMaxHits: 10,
            btnPlusMaxHits: 10,
            sizeChange: 1
	    };

            opcoes = $.extend(defaults, opcoes);

        var limite=new Array();
        var fontsize_padrao=new Array();

        $(this).each(function(i){
            limite[i]=0;
            fontsize_padrao[i];
        })

        $('#jfontsize-minus, #jfontsize-default, #jfontsize-plus').removeAttr('href');
        $('#jfontsize-minus, #jfontsize-default, #jfontsize-plus').css('cursor', 'pointer');

      var decreaseFont = function(i) {
        if (limite[i]>(-(opcoes.btnMinusMaxHits))){
          fontsize_padrao[i]=$(this).css('font-size');
          fontsize_padrao[i]=fontsize_padrao[i].replace('px', '');
          fontsize=$(this).css('font-size');
          fontsize=parseInt(fontsize.replace('px', ''));
          fontsize=fontsize-(opcoes.sizeChange);
          fontsize_padrao[i]=fontsize_padrao[i]-(limite[i]*opcoes.sizeChange);
          limite[i]--;
          $(this).css('font-size', fontsize+'px');
	  $(this).css('line-height', (fontsize + 6) + 'px')
        }
      }

      var increaseFont = function(i) {
        if (limite[i]<opcoes.btnPlusMaxHits){
          fontsize_padrao[i]=$(this).css('font-size');
          fontsize_padrao[i]=fontsize_padrao[i].replace('px', '');
          fontsize=$(this).css('font-size');
          fontsize=parseInt(fontsize.replace('px', ''));
          fontsize=fontsize+opcoes.sizeChange;
          fontsize_padrao[i]=fontsize_padrao[i]-(limite[i]*opcoes.sizeChange);
          limite[i]++;
          $(this).css('font-size', fontsize+'px');
	  $(this).css('line-height', (fontsize + 6) + 'px')
        }
      }

      var fontStr = $.cookie("fontSize");
      if (fontStr != null) {
	var fonts = JSON.parse(fontStr);
	if (fonts != null) {
	  $this.each(function(i) {
	    var increase = $.proxy(increaseFont, $(this));
	    var decrease = $.proxy(decreaseFont, $(this));
	    var counter = 0;
	    if (fonts.length > i) {
	      counter = fonts[i];
	    }
	    while (counter > 0) {
	      increase(i);
	      --counter;
	    }
	    while (counter < 0) {
	      decrease(i);
	      ++counter;
	    }
	  });
	}
      }

        /* Ao do Boto A- */
        $('#jfontsize-minus').click(function(){
          $this.each(decreaseFont);
	  $.cookie("fontSize", JSON.stringify(limite), { expires: 365, path: "/" });
        })

        /* Ao do Boto A */
        $('#jfontsize-default').click(function(){
          $this.each(function(i){
            limite[i]=0;
            $(this).css('font-size', fontsize_padrao[i]+'px');
	    $(this).css('line-height', (fontsize_padrao[i] + 6) + 'px')
          });
	  $.cookie("fontSize", JSON.stringify(limite), { expires: 365, path: "/" });
        })

        /* Ao do Boto A+ */
        $('#jfontsize-plus').click(function(){
          $this.each(increaseFont);
	  $.cookie("fontSize", JSON.stringify(limite), { expires: 365, path: "/" });
        })
    };
})(jQuery);
define("jquery-jfontsize", function(){});

eval("// RoomMenu.js\n//\n// Handlers for the menu bar\n\n/*global define: true */\ndefine(\'js/roomMenu\',[\'jquery\', \'appnet\', \'js/roomInfo\', \'js/editRoomModal\',\n        \'text!template/roomMenu.html\',\n        \'jquery-jfontsize\'],\nfunction ($, appnet, roomInfo, editRoomModal, menuTemplate) {\n  \'use strict\';\n\n  var roomMenu = {};\n\n  var container;\n\n  roomMenu.init = function (menuContainer, history)\n  {\n    container = menuContainer;\n    container.append(menuTemplate);\n\n    initNotify();\n    $(\'#edit-room-button\').click(clickEditRoom);\n    $(\'#subscribe-button\').click(clickSubscribe);\n    initFontsize(history);\n    editRoomModal.init();\n    roomMenu.updateChannelView();\n  };\n\n  function initNotify()\n  {\n    var button = $(\'#notify-button\', container);\n    if (window.webkitNotifications &&\n        window.webkitNotifications.checkPermission() !== 0) {\n      button.show();\n      button.click(clickNotify);\n    } else {\n      button.hide();\n    }\n  }\n\n  function clickNotify(event)\n  {\n    event.preventDefault();\n    window.webkitNotifications.requestPermission();\n    $(\'#notify-button\', container).hide();\n    return false;\n  }\n\n  function clickEditRoom(event)\n  {\n    event.preventDefault();\n    editRoomModal.update(roomInfo.channel);\n    editRoomModal.show();\n    return false;\n  }\n\n  function clickSubscribe(event)\n  {\n    event.preventDefault();\n    toggleSubscribe();\n    return false;\n  }\n\n  function initFontsize(history)\n  {\n    $(\'#chat-display-row\').jfontsize({\n      btnMinusClasseId: \'#jfontsize-minus\',\n      btnDefaultClasseId: \'#jfontsize-default\',\n      btnPlusClasseId: \'#jfontsize-plus\',\n      btnMinusMaxHits: 2,\n      btnPlusMaxHits: 9,\n      sizeChange: 3\n    });\n    var scrollMethod = $.proxy(history.scrollToBottom, history);\n    $(\'#jfontsize-minus\').click(scrollMethod);\n    $(\'#jfontsize-default\').click(scrollMethod);\n    $(\'#jfontsize-plus\').click(scrollMethod);\n  }\n\n  roomMenu.updateChannelView = function ()\n  {\n    var name = appnet.note.findPatterName(roomInfo.channel);\n    if (! name)\n    {\n      name = \'PM\';\n    }\n    var status = appnet.renderStatus(roomInfo.channel);\n    $(\'#room-name\').html(\'<strong>\' + name + \'</strong>\');\n    $(\'#room-status\').html(status);\n    if (roomInfo.channel.you_subscribed) {\n      $(\'#subscribe-button\').html(\'Unsubscribe\');\n    } else {\n      $(\'#subscribe-button\').html(\'Subscribe\');\n    }\n    if (editRoomModal.canEditChannel(roomInfo.channel)) {\n      $(\'#edit-room-button\').html(\'Edit Room\');\n    } else {\n      $(\'#edit-room-button\').html(\'View Room\');\n    }\n  };\n\n  function toggleSubscribe()\n  {\n    if (roomInfo.channel.you_subscribed)\n    {\n      appnet.api.deleteSubscription(roomInfo.id, { include_annotations: 1 },\n                                    $.proxy(roomInfo.completeChannelInfo,\n                                            roomInfo),\n                                    failToggleSubscribe);\n    }\n    else\n    {\n      appnet.api.createSubscription(roomInfo.id, { include_annotations: 1 },\n                                    $.proxy(roomInfo.completeChannelInfo,\n                                            roomInfo),\n                                    failToggleSubscribe);\n    }\n  }\n\n  function failToggleSubscribe(response)\n  {\n  }\n\n  return roomMenu;\n});\n\n//@ sourceURL=/js/roomMenu.js");

eval("define(\'text!template/ChatForm.html\',[],function () { return \'<form class=\"form-inline sendForm\">\\r\\n  <input type=\"text\" class=\"span9 messageText\" maxlength=\"256\">\\r\\n  <button type=\"submit\" value=\"Send\" class=\"sendButton btn btn-primary\">Send</button>\\r\\n  <button value=\"Broadcast\" class=\"broadcastButton btn btn-primary\">Broadcast</button>\\r\\n<!--\\r\\n  <button id=\"embed-button\" value=\"Embed\" class=\"btn btn-primary pull-right\">Embed</button>\\r\\n-->\\r\\n</form>\\r\\n<div class=\"must-authorize\">\\r\\n  <p>You must <a class=\"authorizeButton btn btn-primary\">Authorize</a>\\r\\n     Patter to chat.</p>\\r\\n</div>\\r\\n<div class=\"read-only\">\\r\\n  <p>This room is read-only. You can watch, but not chat.</p>\\r\\n</div>\\r\\n\';});\n\n//@ sourceURL=/text!template/ChatForm.html");

/*
 *
 * Copyright (c) 2010 C. F., Wong (<a href="http://cloudgen.w0ng.hk">Cloudgen Examplet Store</a>)
 * Licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */
(function(k,e,i,j){k.fn.caret=function(b,l){var a,c,f=this[0],d=k.browser.msie;if(typeof b==="object"&&typeof b.start==="number"&&typeof b.end==="number"){a=b.start;c=b.end}else if(typeof b==="number"&&typeof l==="number"){a=b;c=l}else if(typeof b==="string")if((a=f.value.indexOf(b))>-1)c=a+b[e];else a=null;else if(Object.prototype.toString.call(b)==="[object RegExp]"){b=b.exec(f.value);if(b!=null){a=b.index;c=a+b[0][e]}}if(typeof a!="undefined"){if(d){d=this[0].createTextRange();d.collapse(true);
d.moveStart("character",a);d.moveEnd("character",c-a);d.select()}else{this[0].selectionStart=a;this[0].selectionEnd=c}this[0].focus();return this}else{if(d){c=document.selection;if(this[0].tagName.toLowerCase()!="textarea"){d=this.val();a=c[i]()[j]();a.moveEnd("character",d[e]);var g=a.text==""?d[e]:d.lastIndexOf(a.text);a=c[i]()[j]();a.moveStart("character",-d[e]);var h=a.text[e]}else{a=c[i]();c=a[j]();c.moveToElementText(this[0]);c.setEndPoint("EndToEnd",a);g=c.text[e]-a.text[e];h=g+a.text[e]}}else{g=
f.selectionStart;h=f.selectionEnd}a=f.value.substring(g,h);return{start:g,end:h,text:a,replace:function(m){return f.value.substring(0,g)+m+f.value.substring(h,f.value[e])}}}}})(jQuery,"length","createRange","duplicate");
define("jquery-caret", function(){});

eval("// ChatForm.js\n//\n// A form used for submitting messages to a Patter chat room.\n\n/*global define:true */\ndefine(\'js/ChatForm\',[\'jquery\', \'appnet\',\n        \'text!template/ChatForm.html\',\n        \'jquery-caret\'],\nfunction ($, appnet, chatTemplate) {\n  \'use strict\';\n\n  function ChatForm(root, channel, postCallback)\n  {\n    this.root = root;\n    this.channelId = channel.id;\n    this.channelName = appnet.note.findPatterName(channel);\n    this.postCallback = postCallback;\n\n    root.html(chatTemplate);\n    this.input = $(\'.messageText\', root);\n    $(\'.sendForm\', root).submit($.proxy(clickSend, this));\n    if (channel.type === \'net.patter-app.room\')\n    {\n      $(\'.broadcastButton\', root).click($.proxy(clickBroadcast, this));\n    }\n    else\n    {\n      $(\'.broadcastButton\', root).hide();\n    }\n    $(\'.authorizeButton\', root).click($.proxy(clickAuthorize, this));\n    $(\'.sendForm\', root).hide();\n    $(\'.must-authorize\', root).hide();\n    $(\'.read-only\', root).hide();\n    if (! appnet.isLogged())\n    {\n      $(\'.must-authorize\', root).show();\n    }\n    else if (! channel.writers.you)\n    {\n      $(\'.read-only\', root).show();\n    }\n    else\n    {\n      $(\'.sendForm\', root).show();\n    }\n  }\n\n  var clickSend = function (event)\n  {\n    event.preventDefault();\n    if (this.input.val().length > 0)\n    {\n      var text = this.input.val();\n      this.postMessage(text, getImageUrl(text));\n      this.input.val(\'\');\n    }\n    return false;\n  };\n\n  var clickBroadcast = function (event)\n  {\n    event.preventDefault();\n    if (this.input.val().length > 0)\n    {\n      var text = this.input.val();\n      this.getEntities(text, getImageUrl(text));\n      this.input.val(\'\');\n    }\n    return false;\n  };\n\n  var clickAuthorize = function (event)\n  {\n    event.preventDefault();\n    appnet.api.authorize();\n    return false;\n  };\n\n  ChatForm.prototype.postMessage = function (messageString, annotations, links)\n  {\n    var post = {\n      text: messageString,\n      annotations: annotations\n    };\n    if (links !== undefined)\n    {\n      post.entities = { links: links };\n    }\n    appnet.api.createMessage(this.channelId, post, { include_annotations: 1 },\n                             $.proxy(completePostMessage, this),\n                             $.proxy(failPostMessage, this));\n  };\n\n  var completePostMessage = function (response)\n  {\n    this.postCallback([response.data]);\n  };\n\n  var failPostMessage = function (response)\n  {\n  };\n\n  ChatForm.prototype.getEntities = function (messageString, annotations)\n  {\n    var context = {\n      message: messageString,\n      annotations: annotations,\n      chat: this\n    };\n    console.log(messageString);\n    console.dir(getImageUrl(messageString));\n    console.log(\'beforeProcess\');\n    console.dir(context.annotations);\n    appnet.api.processText({ text: messageString }, {},\n                           $.proxy(broadcastMessage, context),\n                           failBroadcastMessage);\n  };\n\n  var broadcastMessage = function (response)\n  {\n    var postAnnotations = this.annotations.slice(0);\n    var url = \'http://patter-app.net/room.html?channel=\' + this.chat.channelId;\n    postAnnotations.push({\n      type: \'net.app.core.crosspost\',\n      value: {\n        canonical_url: url\n      }\n    });\n    postAnnotations.push({\n      type: \'net.app.core.channel.invite\',\n      value: {\n        channel_id: this.chat.channelId\n      }\n    });\n    var post = {\n      text: this.message,\n      annotations: postAnnotations\n    };\n    var text = this.message;\n    var promo = \' \\n\\n\' + this.chat.channelName + \' <=>\';\n    if (text.length + promo.length <= 256)\n    {\n      var links = response.data.entities.links;\n      if (! links)\n      {\n        links = [];\n      }\n      links.push({\n        text: \'<=>\',\n        url: url,\n        pos: text.length + promo.length - 3,\n        len: 3\n      });\n      post.text = text + promo;\n      post.entities = {\n        links: links\n      };\n    }\n    var context = {\n      message: this.message,\n      annotations: this.annotations,\n      chat: this.chat\n    };\n    appnet.api.createPost(post, { include_annotations: 1 },\n                          $.proxy(completeBroadcastMessage, context),\n                          $.proxy(failBroadcastMessage, context));\n  };\n\n  var completeBroadcastMessage = function (response)\n  {\n    if (response.data)\n    {\n      var messageAnn = this.annotations.slice(0);\n      var broadcast = appnet.note.broadcastNote(response.data.id,\n                                                response.data.canonical_url);\n      messageAnn.push(broadcast);\n      console.log(\'Before post\');\n      console.dir(messageAnn);\n      this.chat.postMessage(this.message, messageAnn);\n    }\n  };\n\n  var failBroadcastMessage = function (response)\n  {\n  };\n\n\n  ChatForm.prototype.insertUserIntoText = function (event)\n  {\n    event.preventDefault();\n    if (appnet.isLogged())\n    {\n      var user = event.target.id;\n      insertText(user, this.input);\n    }\n    return false;\n  };\n\n  function insertText(user, textBox)\n  {\n    var cursor = textBox.caret().start;\n    var text = textBox.val();\n    var before = text.substring(0, cursor);\n    var after = text.substring(cursor);\n    textBox.focus();\n    textBox.val(before + user + \' \' + after);\n    textBox.caret(cursor + user.length + 1, cursor + user.length + 1);\n  }\n\n\n  function getImageUrl(text) {\n    var result = [];\n    var match = urlRegex.exec(text);\n    if (match !== null) {\n      console.log(\'match\');\n      var url = match[0];\n      var foundIndex = url.length - 4;\n      if (url.indexOf(\'.jpg\') === foundIndex ||\n          url.indexOf(\'.png\') === foundIndex ||\n          url.indexOf(\'.gif\') === foundIndex) {\n        console.log(\'image\');\n        result.push(appnet.note.embedImageNote(url, 200, 200));\n      }\n    }\n    return result;\n  }\n\n  // This whole thing pulled from\n  // https://github.com/nooodle/noodleapp/blob/master/lib/markdown-to-entities.js\n  //\n  // Regex pulled from https://github.com/chriso/node-validator and\n  // country codes pulled from\n  // http://data.iana.org/TLD/tlds-alpha-by-domain.txt\n\n  var urlRegex = /((?:http|https|ftp|scp|sftp):\\/\\/)?(?:\\w+:\\w+@)?(?:localhost|(?:(?:[\\-\\w\\d{1-3}]+\\.)+(?:com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\\.uk|ac\\.uk|it|fr|tv|museum|asia|local|travel|AC|AD|AE|AF|AG|AI|AL|AM|AN|AO|AQ|AR|AS|AT|AU|AW|AX|AZ|BA|BB|BD|BE|BF|BG|BH|BI|BJ|BM|BN|BO|BR|BS|BT|BV|BW|BY|BZ|CA|CC|CD|CF|CG|CH|CI|CK|CL|CM|CN|CO|CR|CU|CV|CW|CX|CY|CZ|DE|DJ|DK|DM|DO|DZ|EC|EE|EG|ER|ES|ET|EU|FI|FJ|FK|FM|FO|FR|GA|GB|GD|GE|GF|GG|GH|GI|GL|GM|GN|GP|GQ|GR|GS|GT|GU|GW|GY|HK|HM|HN|HR|HT|HU|ID|IE|IL|IM|IN|IO|IQ|IR|IS|IT|JE|JM|JO|JP|KE|KG|KH|KI|KM|KN|KP|KR|KW|KY|KZ|LA|LB|LC|LI|LK|LR|LS|LT|LU|LV|LY|MA|MC|MD|ME|MG|MH|MK|ML|MM|MN|MO|MP|MQ|MR|MS|MT|MU|MV|MW|MX|MY|MZ|NA|NC|NE|NF|NG|NI|NL|NO|NP|NR|NU|NZ|OM|PA|PE|PF|PG|PH|PK|PL|PM|PN|PR|PS|PT|PW|PY|QA|RE|RO|RS|RU|RW|SA|SB|SC|SD|SE|SG|SH|SI|SJ|SK|SL|SM|SN|SO|SR|ST|SU|SV|SX|SY|SZ|TC|TD|TF|TG|TH|TJ|TK|TL|TM|TN|TO|TP|TR|TT|TV|TW|TZ|UA|UG|UK|US|UY|UZ|VA|VC|VE|VG|VI|VN|VU|WF|WS|YE|YT|ZA|ZM|ZW))|(?:(?:\\b25[0-5]\\b|\\b[2][0-4][0-9]\\b|\\b[0-1]?[0-9]?[0-9]\\b)(?:\\.(?:\\b25[0-5]\\b|\\b[2][0-4][0-9]\\b|\\b[0-1]?[0-9]?[0-9]\\b)){3}))(?::[\\d]{1,5})?(?:(?:(?:\\/(?:[\\-\\w~!$+|.,=\"\'\\(\\)_\\*:]|%[a-f\\d]{2})+)+|\\/)+|\\?|#)?(?:(?:\\?(?:[\\-\\w~!$+|.,*:]|%[a-f\\d{2}])+=?(?:[\\-\\w~!$+|.,*:=]|%[a-f\\d]{2})*)(?:&(?:[\\-\\w~!$+|.,*:]|%[a-f\\d{2}])+=?(?:[\\-\\w~!$+|.,*:=]|%[a-f\\d]{2})*)*)*(?:#(?:[\\-\\w~!$ |\\/.,*:;=]|%[a-f\\d]{2})*)?/ig;\n\n  return ChatForm;\n});\n\n//@ sourceURL=/js/ChatForm.js");

eval("define(\'text!template/user.html\',[],function () { return \'<div>\\r\\n  <a class=\"userAvatar\" target=\"_blank\">\\r\\n    <img class=\"userAvatarImg\" width=\"33\" height=\"33\">\\r\\n  </a>\\r\\n  <a class=\"userName\" href=\"\"></a>\\r\\n</div>\\r\\n\';});\n\n//@ sourceURL=/text!template/user.html");

eval("// UserList.js\r\n//\r\n// A pane showing a scrollable list of recent users and members\r\n\r\n/*global define:true */\r\ndefine(\'js/UserList\',[\'jquery\', \'util\', \'appnet\',\r\n        \'text!template/user.html\'],\r\nfunction ($, util, appnet, userTemplate) {\r\n  \'use strict\';\r\n\r\n  function UserList(root, userCallback)\r\n  {\r\n    this.root = root;\r\n    this.userCallback = userCallback;\r\n    this.members = {};\r\n    this.postTimes = {};\r\n    this.avatars = {};\r\n    this.myUser = null;\r\n    this.activeList = {};\r\n    this.idleList = {};\r\n    this.user = $(userTemplate);\r\n  }\r\n\r\n  var timeout = {\r\n    // Times in minutes;\r\n    gone: 10,\r\n    idle: 3\r\n  };\r\n\r\n  UserList.prototype.updatePosts = function (data)\r\n  {\r\n    var i = 0;\r\n    for (i = 0; i < data.length; i += 1)\r\n    {\r\n      this.storePostInfo(data[i]);\r\n    }\r\n    this.renderUserList();\r\n  };\r\n\r\n  UserList.prototype.updateChannel = function (channel, members)\r\n  {\r\n    this.members = members;\r\n    var i = 0;\r\n    for (i = 0; i < members.length; i += 1)\r\n    {\r\n      this.addMemberInfo(members[i]);\r\n    }\r\n    if (appnet.user !== null)\r\n    {\r\n      this.addMemberInfo(appnet.user);\r\n    }\r\n    this.renderUserList();\r\n  };\r\n\r\n  UserList.prototype.storePostInfo = function (data)\r\n  {\r\n    var created = new Date(data.created_at).getTime();\r\n    if (this.postTimes[data.user.username] === undefined ||\r\n        this.postTimes[data.user.username] === null ||\r\n        this.postTimes[data.user.username] < created)\r\n    {\r\n      this.postTimes[data.user.username] = created;\r\n      this.avatars[data.user.username] = data.user.avatar_image.url;\r\n    }\r\n  };\r\n\r\n  UserList.prototype.addMemberInfo = function (user)\r\n  {\r\n    if (this.postTimes[user.username] === undefined)\r\n    {\r\n      this.postTimes[user.username] = null;\r\n    }\r\n    this.avatars[user.username] = user.avatar_image.url;\r\n  };\r\n\r\n  UserList.prototype.renderUserList = function ()\r\n  {\r\n    var goneTime = new Date().getTime() - 1000 * 60 * timeout.gone;\r\n    var keys = Object.keys(this.postTimes);\r\n    var i = 0;\r\n    this.recent = {};\r\n    keys.sort();\r\n    for (i = 0; i < keys.length; i += 1)\r\n    {\r\n      var postTime = this.postTimes[keys[i]];\r\n      var shouldShow = ((postTime !== null && postTime >= goneTime) ||\r\n                        this.members[keys[i]] !== undefined);\r\n      if (shouldShow)\r\n      {\r\n        this.updateUser(keys[i], postTime);\r\n      }\r\n      else\r\n      {\r\n        this.removeUser(keys[i]);\r\n      }\r\n    }\r\n  };\r\n\r\n  UserList.prototype.updateUser = function (name, postTime)\r\n  {\r\n    var userClass = getUserClass(name, postTime);\r\n    if (userClass === \'myAccount\')\r\n    {\r\n      if (this.myUser === null)\r\n      {\r\n        this.myUser = this.renderUser(name, userClass);\r\n        this.root.append(this.myUser);\r\n      }\r\n    }\r\n    else if (userClass === \'activeUser\')\r\n    {\r\n      if (this.idleList[name] !== undefined)\r\n      {\r\n        this.activeList[name] = this.idleList[name];\r\n        delete this.idleList[name];\r\n        $(\'.userName\', this.activeList[name]).removeClass(\'idleUser\');\r\n        $(\'.userName\', this.activeList[name]).addClass(\'activeUser\');\r\n      }\r\n      else if (this.activeList[name] === undefined)\r\n      {\r\n        this.activeList[name] = this.renderUser(name, userClass);\r\n        this.root.append(this.activeList[name]);\r\n      }\r\n    }\r\n    else if (userClass === \'idleUser\')\r\n    {\r\n      if (this.activeList[name] !== undefined)\r\n      {\r\n        this.idleList[name] = this.activeList[name];\r\n        delete this.activeList[name];\r\n        $(\'.userName\', this.idleList[name]).removeClass(\'activeUser\');\r\n        $(\'.userName\', this.idleList[name]).addClass(\'idleUser\');\r\n      }\r\n      else if (this.idleList[name] === undefined)\r\n      {\r\n        this.idleList[name] = this.renderUser(name, userClass);\r\n        this.root.append(this.idleList[name]);\r\n      }\r\n    }\r\n  };\r\n\r\n  function getUserClass(name, postTime)\r\n  {\r\n    var result = \'idleUser\';\r\n    var idleTime = new Date().getTime() - 1000 * 60 * timeout.idle;\r\n    if (appnet.user !== null && name === appnet.user.username)\r\n    {\r\n      result = \'myAccount\';\r\n    }\r\n    else if (postTime !== null && postTime >= idleTime)\r\n    {\r\n      result = \'activeUser\';\r\n    }\r\n    return result;\r\n  }\r\n\r\n  UserList.prototype.removeUser = function (name)\r\n  {\r\n    if (this.idleList[name] !== undefined)\r\n    {\r\n      this.idleList[name].remove();\r\n      delete this.idleList[name];\r\n    }\r\n    if (this.activeList[name] !== undefined)\r\n    {\r\n      this.activeList[name].remove();\r\n      delete this.activeList[name];\r\n    }\r\n  };\r\n\r\n  UserList.prototype.renderUser = function (name, userClass)\r\n  {\r\n    var result = this.user.clone();\r\n    var nameNode = $(\'.userName\', result);\r\n    $(\'.userAvatar\', result).attr(\'href\', \'http://alpha.app.net/\' + name);\r\n    $(\'.userAvatarImg\', result).attr(\'src\', this.avatars[name]);\r\n    nameNode.html(\'@\' + name);\r\n    nameNode.attr(\'id\', \'@\' + name);\r\n    nameNode.addClass(userClass);\r\n    nameNode.on(\'click\', this.userCallback);\r\n    return result;\r\n  };\r\n\r\n  return UserList;\r\n});\r\n\n//@ sourceURL=/js/UserList.js");

eval("define(\'text!template/post.html\',[],function () { return \'<div class=\"postRowWrap\">\\r\\n  <div class=\"postRow\">\\r\\n    <span class=\"authorContainer\">\\r\\n      <a class=\"authorAvatar\" target=\"_blank\">\\r\\n        <img class=\"authorAvatarImg\" width=\"23\" height=\"23\">\\r\\n      </a>\\r\\n      <a class=\"author\" href=\"\"></a>\\r\\n    </span>\\r\\n    <span class=\"postBody\">\\r\\n      \\r\\n    </span>\\r\\n    <span class=\"postInfo\">\\r\\n      <a class=\"broadcastLink\" target=\"_blank\"><span class=\"broadcastIcon\"></a>\\r\\n      <span class=\"postTimestamp\"></span>\\r\\n    </span>\\r\\n    <div class=\"embedImageWrapper\">\\r\\n      <a class=\"embedImageLink\" target=\"_blank\">\\r\\n        <img class=\"embedImage\">\\r\\n      </a>\\r\\n    </div>\\r\\n  </div>\\r\\n</div>\\r\\n\';});\n\n//@ sourceURL=/text!template/post.html");

eval("define(\'text!template/postEmoji.html\',[],function () { return \'<img class=\"emoji\" width=\"24\" height=\"24\">\\r\\n\';});\n\n//@ sourceURL=/text!template/postEmoji.html");

;(function($) {

	$.desknoty = function(options) {

		var defaults = {
			icon: null,
			title: "",
			body: "",
			timeout: 5000,
			sticky: false,
			id: null,
			type: 'normal',
			url: '',
			dir: '',
			onClick: function() {},
			onShow: function() {},
			onClose: function() {},
			onError: function() {}
		}

		var p = this, noti = null;

		p.set = {}

		var init = function() {
			p.set = $.extend({}, defaults, options);
			if(isSupported) {
				if(window.webkitNotifications.checkPermission() != 0){
					//getPermissions(init);
				} else {
					if(p.set.type === 'normal') createNoti();
					else if(p.set.type === 'html') createNotiHtml();
				}
			} else {
				alert("Desktop notifications are not supported!");
			}
		}

		var createNoti = function() {
			noti = window.webkitNotifications.createNotification(p.set.icon, p.set.title, p.set.body);
				if(p.set.dir) noti.dir = p.set.dir;
				if(p.set.onclick) noti.onclick = p.set.onclick;
				if(p.set.onshow) noti.onshow = p.set.onshow;
				if(p.set.onclose) noti.onclose = p.set.onclose;
				if(p.set.onerror) noti.onerror = p.set.onerror;
				if(p.set.id) noti.replaceId = p.set.id;
			noti.show();
			if(!p.set.sticky) setTimeout(function(){ noti.cancel(); }, p.set.timeout);
		}
		var createNotiHtml = function() {
			noti = window.webkitNotifications.createHTMLNotification(p.set.url);
				if(p.set.dir) noti.dir = p.set.dir;
				if(p.set.onclick) noti.onclick = p.set.onclick;
				if(p.set.onshow) noti.onshow = p.set.onshow;
				if(p.set.onclose) noti.onclose = p.set.onclose;
				if(p.set.onerror) noti.onerror = p.set.onerror;
				if(p.set.id) noti.replaceId = p.set.id;
			noti.show();
			if(!p.set.sticky) setTimeout(function(){ noti.cancel(); }, p.set.timeout);
		}

		var isSupported = function() {
			if (window.webkitNotifications)return true;
			else return false;
		}
		var getPermissions = function(callback) {
			window.webkitNotifications.requestPermission(callback);
		}
		init();
	}
})(jQuery);
define("jquery-desknoty", function(){});

/*
 * jQuery EasyDate 0.2.4 ($Rev: 54 $)
 * Copyright (c) 2009 Parsha Pourkhomami (parshap@gmail.com)
 * Licensed under the MIT license.
 */
(function(e){e.easydate={};e.easydate.locales={};e.easydate.locales.enUS={future_format:"%s %t",past_format:"%t %s",second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",week:"week",weeks:"weeks",month:"month",months:"months",year:"year",years:"years",yesterday:"yesterday",tomorrow:"tomorrow",now:"just now",ago:"ago","in":"in"};var d={live:true,set_title:true,format_future:true,format_past:true,units:[{name:"now",limit:5},{name:"second",limit:60,in_seconds:1},{name:"minute",limit:3600,in_seconds:60},{name:"hour",limit:86400,in_seconds:3600},{name:"yesterday",limit:172800,past_only:true},{name:"tomorrow",limit:172800,future_only:true},{name:"day",limit:604800,in_seconds:86400},{name:"week",limit:2629743,in_seconds:604800},{name:"month",limit:31556926,in_seconds:2629743},{name:"year",limit:Infinity,in_seconds:31556926}],uneasy_format:function(p){return p.toLocaleDateString()},locale:e.easydate.locales.enUS};var f=0;var k={};var h={};var a={};function l(r,q,p){if(!isNaN(q)&&q!=1){r=r+"s"}return p.locale[r]||r}var o=e.easydate.pause=function(q){var s=function(p){clearTimeout(k[p]);delete k[p];h[p]=true};if(!q){for(var r in k){s(r)}}else{e(q).each(function(){var p=jQuery.data(this);if(!isNaN(k[p])){s(p)}})}};var c=e.easydate.resume=function(p){var s=function(r){delete h[r];b(a[r])};if(!p){for(var q in h){s(q)}}else{e(p).each(function(){var r=jQuery.data(this);if(!isNaN(h[r])){s(r)}})}};var g=e.easydate.set_now=function(q){var r;if(q instanceof Date){r=q.getTime()}else{r=Date.parse(q)}if(isNaN(r)){return}f=r-(new Date()).getTime();for(var p in a){if(!isNaN[k[p]]){clearTimeout(k[p])}b(a[p])}};var n=e.easydate.get_now=function(){var p=new Date();p.setTime(p.getTime()+f);return p};var j=e.easydate.format_date=function(q,x){var r=e.extend({},d,x);var v=((n().getTime()-q.getTime())/1000);var u=Math.abs(v);if(isNaN(v)){return}if((!r.format_future&&v<0)||(!r.format_past&&v>0)){return}for(var s in r.units){var w=r.units[s];if((w.past_only&&v<0)||(w.future_only&&v>0)){continue}if(u<w.limit){if(isNaN(w.in_seconds)){return l(w.name,NaN,r)}var p=u/w.in_seconds;p=Math.round(p);var t;if(v<0){t=l("future_format",NaN,r).replace("%s",l("in",NaN,r))}else{t=l("past_format",NaN,r).replace("%s",l("ago",NaN,r))}return t.replace("%t",p+" "+l(w.name,p,r))}}return r.uneasy_format(q)};function m(r,t){var q=n();var w=((q.getTime()-r.getTime())/1000);var p=Math.abs(w);if(isNaN(w)){return}var v=0;for(var s in t.units){var u=t.units[s];if((u.past_only&&w<0)||(u.future_only&&w>0)){continue}if(p<u.limit){if(isNaN(u.in_seconds)){if(w<0){return(v-p)*1000+100}else{return(u.limit-p)*1000+100}}else{if(w<0){return(p%u.in_seconds)*1000+100}else{return(u.in_seconds-(p%u.in_seconds))*1000+100}}}v=u.limit}if(w<0){for(var s=t.units.length-1;s>=0;s--){var u=t.units[s];if(u.past_only){continue}return(u.limit-p)*1000+100}}}function i(q,r){var p=q.data("easydate.date");if(isNaN(p)){var s;var t=Date.parse(s=q.attr("title"))||Date.parse(s=q.html());if(!isNaN(t)){p=new Date();p.setTime(t);q.data("easydate.date",p);if(r.set_title&&!q.attr("title")){q.attr("title",s)}}}return p}function b(r){var s=r.data("easydate.settings");var p=e.data(r[0]);a[p]=r;delete k[p];var q=i(r,s);if(isNaN(q)){return}r.html(j(q,s));if(s.live){var t=m(q,s);if(!isNaN(t)){if(t>2147483647){t=2147483647}var u=setTimeout(function(){b(r)},Math.round(t));k[p]=u}}}e.fn.easydate=function(p){var q=e.extend({},d,p);this.data("easydate.settings",q);this.removeData("easydate.date");this.each(function(){var r=e.data(this);if(!isNaN(k[r])){clearTimeout(k[r]);delete k[r]}b(e(this))})}})(jQuery);
define("jquery-easydate", function(){});

/*!
 * Title Alert 0.7
 * 
 * Copyright (c) 2009 ESN | http://esn.me
 * Jonatan Heyman | http://heyman.info
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 */
(function(a){a.titleAlert=function(e,c){if(a.titleAlert._running){a.titleAlert.stop()}a.titleAlert._settings=c=a.extend({},a.titleAlert.defaults,c);if(c.requireBlur&&a.titleAlert.hasFocus){return}c.originalTitleInterval=c.originalTitleInterval||c.interval;a.titleAlert._running=true;a.titleAlert._initialText=document.title;document.title=e;var b=true;var d=function(){if(!a.titleAlert._running){return}b=!b;document.title=(b?e:a.titleAlert._initialText);a.titleAlert._intervalToken=setTimeout(d,(b?c.interval:c.originalTitleInterval))};a.titleAlert._intervalToken=setTimeout(d,c.interval);if(c.stopOnMouseMove){a(document).mousemove(function(f){a(this).unbind(f);a.titleAlert.stop()})}if(c.duration>0){a.titleAlert._timeoutToken=setTimeout(function(){a.titleAlert.stop()},c.duration)}};a.titleAlert.defaults={interval:500,originalTitleInterval:null,duration:0,stopOnFocus:true,requireBlur:false,stopOnMouseMove:false};a.titleAlert.stop=function(){clearTimeout(a.titleAlert._intervalToken);clearTimeout(a.titleAlert._timeoutToken);document.title=a.titleAlert._initialText;a.titleAlert._timeoutToken=null;a.titleAlert._intervalToken=null;a.titleAlert._initialText=null;a.titleAlert._running=false;a.titleAlert._settings=null};a.titleAlert.hasFocus=true;a.titleAlert._running=false;a.titleAlert._intervalToken=null;a.titleAlert._timeoutToken=null;a.titleAlert._initialText=null;a.titleAlert._settings=null;a.titleAlert._focus=function(){a.titleAlert.hasFocus=true;if(a.titleAlert._running&&a.titleAlert._settings.stopOnFocus){var b=a.titleAlert._initialText;a.titleAlert.stop();setTimeout(function(){if(a.titleAlert._running){return}document.title=".";document.title=b},1000)}};a.titleAlert._blur=function(){a.titleAlert.hasFocus=false};a(window).bind("focus",a.titleAlert._focus);a(window).bind("blur",a.titleAlert._blur)})(jQuery);
define("jquery-titlealert", function(){});

eval("// ChatHistory.js\r\n//\r\n// A pane showing a scrollable list of chats and posts\r\n\r\n/*global define:true */\r\ndefine(\'js/ChatHistory\',[\'jquery\', \'util\', \'appnet\',\r\n        \'text!template/post.html\', \'text!template/postEmoji.html\',\r\n        \'jquery-desknoty\', \'jquery-easydate\', \'jquery-titlealert\'],\r\nfunction ($, util, appnet, postTemplate, emojiTemplate) {\r\n  \'use strict\';\r\n\r\n  // id is the DOM id of the node to add the history too.\r\n  function ChatHistory(root, authorCallback, avatarUrls)\r\n  {\r\n    this.root = root;\r\n    this.post = $(postTemplate);\r\n    this.shownPosts = {};\r\n    this.authorCallback = authorCallback;\r\n    this.avatarUrls = avatarUrls;\r\n    this.atBottom = true;\r\n    this.root.scroll($.proxy(onScroll, this));\r\n    $(window).on(\'resize\', $.proxy(this.scrollToBottom, this));\r\n    updateTimestamps();\r\n  }\r\n\r\n  ChatHistory.prototype.update = function (data, goBack)\r\n  {\r\n    var allPosts = $(\'<div/>\');\r\n    var last = null;\r\n    var i = 0;\r\n    for (i = data.length - 1; i > -1; i -= 1)\r\n    {\r\n      if (this.validPost(data[i]))\r\n      {\r\n        var post = this.post.clone();\r\n        this.renderPost(data[i], post);\r\n        allPosts.append(post);\r\n        last = {\r\n          username: \'@\' + data[i].user.username,\r\n          text: util.htmlEncode(data[i].text)\r\n        };\r\n        this.shownPosts[data[i].id] = 1;\r\n      }\r\n    }\r\n    if (last !== null)\r\n    {\r\n      this.addPostsToFeed(allPosts.contents(), goBack, last);\r\n    }\r\n  };\r\n\r\n  ChatHistory.prototype.validPost = function (data)\r\n  {\r\n    var result = true;\r\n    if (! data.text)\r\n    {\r\n      result = false;\r\n    }\r\n    else if (this.shownPosts.hasOwnProperty(data.id))\r\n    {\r\n      result = false;\r\n    }\r\n    return result;\r\n  };\r\n\r\n  var onScroll = function (event)\r\n  {\r\n    var bottom = this.root.prop(\'scrollHeight\') - this.root.height();\r\n    this.atBottom = (this.root.scrollTop() >= bottom);\r\n  };\r\n\r\n  ChatHistory.prototype.renderPost = function (data, post)\r\n  {\r\n    var body = embedEmoji(appnet.textToHtml(data.text, data.entities).html());\r\n    var userMention;\r\n    if (appnet.user !== null) {\r\n      userMention = new RegExp(\'@\' + appnet.user.username + \'[^a-zA-Z\\\\-_]\');\r\n      if (data.user.username === appnet.user.username)\r\n      {\r\n        $(\'.postRow\', post).addClass(\'myPost\');\r\n      }\r\n      else if (userMention.test(body))\r\n      {\r\n        $(\'.postRow\', post).addClass(\'mentionPost\');\r\n      }\r\n    }\r\n\r\n    var broadcast = appnet.note.findAnnotation(\'net.patter-app.broadcast\',\r\n                                               data.annotations);\r\n    if (broadcast !== null)\r\n    {\r\n      $(\'.broadcastLink\', post).remove();\r\n      $(\'.postRow\', post).addClass(\'broadcastPost\');\r\n    }\r\n    else\r\n    {\r\n      $(\'.broadcastLink\', post).remove();\r\n    }\r\n\r\n    if (this.avatarUrls[data.user.username] !== undefined)\r\n    {\r\n      $(\'.authorAvatar\', post).attr(\'href\', \'http://alpha.app.net/\' +\r\n                                    data.user.username);\r\n      $(\'.authorAvatarImg\', post).attr(\'src\',\r\n                                       this.avatarUrls[data.user.username]);\r\n    }\r\n    else\r\n    {\r\n      $(\'.authorAvatar\', post).remove();\r\n    }\r\n\r\n    var author = $(\'.author\', post);\r\n    author.attr(\'id\', \'@\' + data.user.username);\r\n//    author.attr(\'style\',\r\n//                \'background: \' + makeUserColor(\'@\' + data.user.username) + \';\');\r\n    author.text(data.user.username);\r\n    author.on(\'click\', this.authorCallback);\r\n    \r\n    $(\'.postBody\', post).prepend(body);\r\n\r\n    renderEmbedImage(data, post);\r\n\r\n    var timestamp = $(\'.postTimestamp\', post);\r\n    timestamp.attr(\'title\', data.created_at);\r\n    formatTimestamp(timestamp);\r\n\r\n\r\n//    $(\'.mention\', row).each(function (index, element) {\r\n//      element.setAttribute(\'style\',\r\n//                           \'color: \' + makeUserColor(element.id) + \';\');\r\n//    });\r\n  };\r\n\r\n  function renderEmbedImage(data, post) {\r\n    var embed = appnet.note.findAnnotation(\'net.app.core.oembed\',\r\n                                           data.annotations);\r\n    if (embed !== null && embed.type === \'photo\') {\r\n      var height = embed.height;\r\n      if (height === undefined || height > 200)\r\n      {\r\n        height = 200;\r\n      }\r\n      $(\'.embedLink\', post).attr(\'href\', embed.url);\r\n      var image = $(\'.embedImage\', post);\r\n      image.attr(\'src\', embed.url);\r\n      image.attr(\'height\', height);\r\n      image.attr(\'style\', \'max-height: \' + height + \'px;\');\r\n    }\r\n    else\r\n    {\r\n      $(\'.embedImageWrapper\', post).remove();\r\n    }\r\n  }\r\n\r\n  function embedEmoji(text) {\r\n    var result = \'\';\r\n    var start = 0;\r\n    var matches = text.match(/:[a-z0-9_+\\-]+:/g);\r\n    var i = 0;\r\n    if (matches !== null) {\r\n      for (i = 0; i < matches.length; i += 1) {\r\n        var index = text.indexOf(matches[i], start);\r\n        result += text.substr(start, index - start);\r\n        var name = matches[i].substr(1, matches[i].length - 2);\r\n        if (validEmoji[name] === 1) {\r\n          var img = $(emojiTemplate);\r\n          img.attr(\'src\', \'http://lib-storage.s3-website-us-east-1.amazonaws.com/emoji/\' + name + \'.png\');\r\n          img.attr(\'alt\', \':\' + name + \':\');\r\n          img.attr(\'title\', \':\' + name + \':\');\r\n          result += $(\'<div/>\').append(img).html();\r\n        } else {\r\n          result += \':\' + name + \':\';\r\n        }\r\n        start = index + name.length + 2;\r\n      }\r\n    }\r\n    result += text.substr(start);\r\n    return result;\r\n  }\r\n\r\n  ChatHistory.prototype.addPostsToFeed = function (posts, addBefore, last)\r\n  {\r\n    var fromBottom = this.root.prop(\'scrollHeight\') - this.root.scrollTop();\r\n    if (addBefore)\r\n    {\r\n      this.root.prepend(posts);\r\n    }\r\n    else\r\n    {\r\n      this.root.append(posts);\r\n      if (! util.has_focus) {\r\n        $.titleAlert(\'New Message\', {\r\n          duration: 10000,\r\n          interval: 1000\r\n        });\r\n        $.desknoty({\r\n          icon: \'patter-top-mobile.png\',\r\n          title: last.username,\r\n          body: last.text,\r\n          url: \'\'\r\n        });\r\n        if (window.fluid)\r\n        {\r\n          window.fluid.showGrowlNotification({\r\n            title: last.username,\r\n            description: last.text,\r\n            icon: \'patter-top-mobile.png\',\r\n            sticky: false\r\n          });\r\n        }\r\n      }\r\n    }\r\n    if (this.atBottom)\r\n    {\r\n      this.scrollToBottom();\r\n    }\r\n    else\r\n    {\r\n      scrollTo(this.root, fromBottom);\r\n    }\r\n  };\r\n\r\n  function scrollTo(root, fromBottom)\r\n  {\r\n    var newBottom = root.prop(\'scrollHeight\') - fromBottom;\r\n    root.scrollTop(newBottom);\r\n    var scrollDown = function ()\r\n    {\r\n      newBottom = root.prop(\'scrollHeight\') - fromBottom;\r\n      root.scrollTop(newBottom);\r\n    };\r\n    setTimeout(scrollDown, 0);\r\n  }\r\n\r\n  ChatHistory.prototype.checkBottom = function ()\r\n  {\r\n    if (this.atBottom)\r\n    {\r\n      this.scrollToBottom();\r\n    }\r\n  };\r\n\r\n  ChatHistory.prototype.scrollToBottom = function (event)\r\n  {\r\n    if (event)\r\n    {\r\n      event.preventDefault();\r\n    }\r\n    scrollTo(this.root, 0);\r\n    this.atBottom = true;\r\n    return false;\r\n  };\r\n\r\n  function formatTimestamp(node) {\r\n    node.easydate({\r\n      locale: {\r\n        \'future_format\': \'%s %t\',\r\n        \'past_format\': \'%t %s\',\r\n        \'second\': \'s\',\r\n        \'seconds\': \'s\',\r\n        \'minute\': \'m\',\r\n        \'minutes\': \'m\',\r\n        \'hour\': \'h\',\r\n        \'hours\': \'h\',\r\n        \'day\': \'day\',\r\n        \'days\': \'days\',\r\n        \'week\': \'week\',\r\n        \'weeks\': \'weeks\',\r\n        \'month\': \'month\',\r\n        \'months\': \'months\',\r\n        \'year\': \'year\',\r\n        \'years\': \'years\',\r\n        \'yesterday\': \'yesterday\',\r\n        \'tomorrow\': \'tomorrow\',\r\n        \'now\': \'now\',\r\n        \'ago\': \' \',\r\n        \'in\': \'in\'\r\n      },\r\n      live: false\r\n    });\r\n  }\r\n\r\n  var timestampTimer = null;\r\n\r\n  function updateTimestamps()\r\n  {\r\n    clearTimeout(timestampTimer);\r\n    formatTimestamp($(\'.postTimestamp\'));\r\n    timestampTimer = setTimeout(updateTimestamps, 60 * 1000);\r\n  }\r\n\r\n  function makeUserColor(user) {\r\n    /*jslint bitwise: true*/\r\n    var hash = getHash(user);\r\n    var color = (hash & 0x007f7f7f).toString(16);\r\n    while (color.length < 6) {\r\n      color = \'0\' + color;\r\n    }\r\n    return \'#\' + color;\r\n  }\r\n\r\n  function getHash(str) {\r\n    /*jslint bitwise: true*/\r\n    var hash = 0;\r\n    if (str.length === 0)\r\n    {\r\n      return hash;\r\n    }\r\n    var i = 0;\r\n    for (i = 0; i < str.length; i += 1) {\r\n      var char = str.charCodeAt(i);\r\n      hash = ((hash << 5) - hash) + char;\r\n      hash = hash & hash; // Convert to 32bit integer\r\n    }\r\n    return hash;\r\n  }\r\n\r\n  var validEmoji = {\r\n    \'+1\': 1,\r\n    \'-1\': 1,\r\n    \'100\': 1,\r\n    \'1234\': 1,\r\n    \'8ball\': 1,\r\n    \'a\': 1,\r\n    \'ab\': 1,\r\n    \'abc\': 1,\r\n    \'abcd\': 1,\r\n    \'accept\': 1,\r\n    \'aerial_tramway\': 1,\r\n    \'airplane\': 1,\r\n    \'alarm_clock\': 1,\r\n    \'alien\': 1,\r\n    \'ambulance\': 1,\r\n    \'anchor\': 1,\r\n    \'angel\': 1,\r\n    \'anger\': 1,\r\n    \'angry\': 1,\r\n    \'anguished\': 1,\r\n    \'ant\': 1,\r\n    \'apple\': 1,\r\n    \'aquarius\': 1,\r\n    \'aries\': 1,\r\n    \'arrow_backward\': 1,\r\n    \'arrow_double_down\': 1,\r\n    \'arrow_double_up\': 1,\r\n    \'arrow_down\': 1,\r\n    \'arrow_down_small\': 1,\r\n    \'arrow_forward\': 1,\r\n    \'arrow_heading_down\': 1,\r\n    \'arrow_heading_up\': 1,\r\n    \'arrow_left\': 1,\r\n    \'arrow_lower_left\': 1,\r\n    \'arrow_lower_right\': 1,\r\n    \'arrow_right\': 1,\r\n    \'arrow_right_hook\': 1,\r\n    \'arrow_up\': 1,\r\n    \'arrow_up_down\': 1,\r\n    \'arrow_up_small\': 1,\r\n    \'arrow_upper_left\': 1,\r\n    \'arrow_upper_right\': 1,\r\n    \'arrows_clockwise\': 1,\r\n    \'arrows_counterclockwise\': 1,\r\n    \'art\': 1,\r\n    \'articulated_lorry\': 1,\r\n    \'astonished\': 1,\r\n    \'athletic_shoe\': 1,\r\n    \'atm\': 1,\r\n    \'b\': 1,\r\n    \'baby\': 1,\r\n    \'baby_bottle\': 1,\r\n    \'baby_chick\': 1,\r\n    \'baby_symbol\': 1,\r\n    \'back\': 1,\r\n    \'baggage_claim\': 1,\r\n    \'balloon\': 1,\r\n    \'ballot_box_with_check\': 1,\r\n    \'bamboo\': 1,\r\n    \'banana\': 1,\r\n    \'bangbang\': 1,\r\n    \'bank\': 1,\r\n    \'bar_chart\': 1,\r\n    \'barber\': 1,\r\n    \'baseball\': 1,\r\n    \'basketball\': 1,\r\n    \'bath\': 1,\r\n    \'bathtub\': 1,\r\n    \'battery\': 1,\r\n    \'bear\': 1,\r\n    \'bee\': 1,\r\n    \'beer\': 1,\r\n    \'beers\': 1,\r\n    \'beetle\': 1,\r\n    \'beginner\': 1,\r\n    \'bell\': 1,\r\n    \'bento\': 1,\r\n    \'bicyclist\': 1,\r\n    \'bike\': 1,\r\n    \'bikini\': 1,\r\n    \'bird\': 1,\r\n    \'birthday\': 1,\r\n    \'black_circle\': 1,\r\n    \'black_joker\': 1,\r\n    \'black_large_square\': 1,\r\n    \'black_medium_small_square\': 1,\r\n    \'black_medium_square\': 1,\r\n    \'black_nib\': 1,\r\n    \'black_small_square\': 1,\r\n    \'black_square_button\': 1,\r\n    \'blossom\': 1,\r\n    \'blowfish\': 1,\r\n    \'blue_book\': 1,\r\n    \'blue_car\': 1,\r\n    \'blue_heart\': 1,\r\n    \'blush\': 1,\r\n    \'boar\': 1,\r\n    \'boat\': 1,\r\n    \'bomb\': 1,\r\n    \'book\': 1,\r\n    \'bookmark\': 1,\r\n    \'bookmark_tabs\': 1,\r\n    \'books\': 1,\r\n    \'boom\': 1,\r\n    \'boot\': 1,\r\n    \'bouquet\': 1,\r\n    \'bow\': 1,\r\n    \'bowling\': 1,\r\n    \'bowtie\': 1,\r\n    \'boy\': 1,\r\n    \'bread\': 1,\r\n    \'bride_with_veil\': 1,\r\n    \'bridge_at_night\': 1,\r\n    \'briefcase\': 1,\r\n    \'broken_heart\': 1,\r\n    \'bug\': 1,\r\n    \'bulb\': 1,\r\n    \'bullettrain_front\': 1,\r\n    \'bullettrain_side\': 1,\r\n    \'bus\': 1,\r\n    \'busstop\': 1,\r\n    \'bust_in_silhouette\': 1,\r\n    \'busts_in_silhouette\': 1,\r\n    \'cactus\': 1,\r\n    \'cake\': 1,\r\n    \'calendar\': 1,\r\n    \'calling\': 1,\r\n    \'camel\': 1,\r\n    \'camera\': 1,\r\n    \'cancer\': 1,\r\n    \'candy\': 1,\r\n    \'capital_abcd\': 1,\r\n    \'capricorn\': 1,\r\n    \'car\': 1,\r\n    \'card_index\': 1,\r\n    \'carousel_horse\': 1,\r\n    \'cat\': 1,\r\n    \'cat2\': 1,\r\n    \'cd\': 1,\r\n    \'chart\': 1,\r\n    \'chart_with_downwards_trend\': 1,\r\n    \'chart_with_upwards_trend\': 1,\r\n    \'checkered_flag\': 1,\r\n    \'cherries\': 1,\r\n    \'cherry_blossom\': 1,\r\n    \'chestnut\': 1,\r\n    \'chicken\': 1,\r\n    \'children_crossing\': 1,\r\n    \'chocolate_bar\': 1,\r\n    \'christmas_tree\': 1,\r\n    \'church\': 1,\r\n    \'cinema\': 1,\r\n    \'circus_tent\': 1,\r\n    \'city_sunrise\': 1,\r\n    \'city_sunset\': 1,\r\n    \'cl\': 1,\r\n    \'clap\': 1,\r\n    \'clapper\': 1,\r\n    \'clipboard\': 1,\r\n    \'clock1\': 1,\r\n    \'clock10\': 1,\r\n    \'clock1030\': 1,\r\n    \'clock11\': 1,\r\n    \'clock1130\': 1,\r\n    \'clock12\': 1,\r\n    \'clock1230\': 1,\r\n    \'clock130\': 1,\r\n    \'clock2\': 1,\r\n    \'clock230\': 1,\r\n    \'clock3\': 1,\r\n    \'clock330\': 1,\r\n    \'clock4\': 1,\r\n    \'clock430\': 1,\r\n    \'clock5\': 1,\r\n    \'clock530\': 1,\r\n    \'clock6\': 1,\r\n    \'clock630\': 1,\r\n    \'clock7\': 1,\r\n    \'clock730\': 1,\r\n    \'clock8\': 1,\r\n    \'clock830\': 1,\r\n    \'clock9\': 1,\r\n    \'clock930\': 1,\r\n    \'closed_book\': 1,\r\n    \'closed_lock_with_key\': 1,\r\n    \'closed_umbrella\': 1,\r\n    \'cloud\': 1,\r\n    \'clubs\': 1,\r\n    \'cn\': 1,\r\n    \'cocktail\': 1,\r\n    \'coffee\': 1,\r\n    \'cold_sweat\': 1,\r\n    \'collision\': 1,\r\n    \'computer\': 1,\r\n    \'confetti_ball\': 1,\r\n    \'confounded\': 1,\r\n    \'confused\': 1,\r\n    \'congratulations\': 1,\r\n    \'construction\': 1,\r\n    \'construction_worker\': 1,\r\n    \'convenience_store\': 1,\r\n    \'cookie\': 1,\r\n    \'cool\': 1,\r\n    \'cop\': 1,\r\n    \'copyright\': 1,\r\n    \'corn\': 1,\r\n    \'couple\': 1,\r\n    \'couple_with_heart\': 1,\r\n    \'couplekiss\': 1,\r\n    \'cow\': 1,\r\n    \'cow2\': 1,\r\n    \'credit_card\': 1,\r\n    \'crescent_moon\': 1,\r\n    \'crocodile\': 1,\r\n    \'crossed_flags\': 1,\r\n    \'crown\': 1,\r\n    \'cry\': 1,\r\n    \'crying_cat_face\': 1,\r\n    \'crystal_ball\': 1,\r\n    \'cupid\': 1,\r\n    \'curly_loop\': 1,\r\n    \'currency_exchange\': 1,\r\n    \'curry\': 1,\r\n    \'custard\': 1,\r\n    \'customs\': 1,\r\n    \'cyclone\': 1,\r\n    \'dancer\': 1,\r\n    \'dancers\': 1,\r\n    \'dango\': 1,\r\n    \'dart\': 1,\r\n    \'dash\': 1,\r\n    \'date\': 1,\r\n    \'de\': 1,\r\n    \'deciduous_tree\': 1,\r\n    \'department_store\': 1,\r\n    \'diamond_shape_with_a_dot_inside\': 1,\r\n    \'diamonds\': 1,\r\n    \'disappointed\': 1,\r\n    \'disappointed_relieved\': 1,\r\n    \'dizzy\': 1,\r\n    \'dizzy_face\': 1,\r\n    \'do_not_litter\': 1,\r\n    \'dog\': 1,\r\n    \'dog2\': 1,\r\n    \'dollar\': 1,\r\n    \'dolls\': 1,\r\n    \'dolphin\': 1,\r\n    \'door\': 1,\r\n    \'doughnut\': 1,\r\n    \'dragon\': 1,\r\n    \'dragon_face\': 1,\r\n    \'dress\': 1,\r\n    \'dromedary_camel\': 1,\r\n    \'droplet\': 1,\r\n    \'dvd\': 1,\r\n    \'ear\': 1,\r\n    \'ear_of_rice\': 1,\r\n    \'earth_africa\': 1,\r\n    \'earth_americas\': 1,\r\n    \'earth_asia\': 1,\r\n    \'egg\': 1,\r\n    \'eggplant\': 1,\r\n    \'eight\': 1,\r\n    \'eight_pointed_black_star\': 1,\r\n    \'eight_spoked_asterisk\': 1,\r\n    \'electric_plug\': 1,\r\n    \'elephant\': 1,\r\n    \'email\': 1,\r\n    \'e-mail\': 1,\r\n    \'end\': 1,\r\n    \'envelope\': 1,\r\n    \'envelope_with_arrow\': 1,\r\n    \'es\': 1,\r\n    \'euro\': 1,\r\n    \'european_castle\': 1,\r\n    \'european_post_office\': 1,\r\n    \'evergreen_tree\': 1,\r\n    \'exclamation\': 1,\r\n    \'expressionless\': 1,\r\n    \'eyeglasses\': 1,\r\n    \'eyes\': 1,\r\n    \'facepunch\': 1,\r\n    \'factory\': 1,\r\n    \'fallen_leaf\': 1,\r\n    \'family\': 1,\r\n    \'fast_forward\': 1,\r\n    \'fax\': 1,\r\n    \'fearful\': 1,\r\n    \'feelsgood\': 1,\r\n    \'feet\': 1,\r\n    \'ferris_wheel\': 1,\r\n    \'file_folder\': 1,\r\n    \'finnadie\': 1,\r\n    \'fire\': 1,\r\n    \'fire_engine\': 1,\r\n    \'fireworks\': 1,\r\n    \'first_quarter_moon\': 1,\r\n    \'first_quarter_moon_with_face\': 1,\r\n    \'fish\': 1,\r\n    \'fish_cake\': 1,\r\n    \'fishing_pole_and_fish\': 1,\r\n    \'fist\': 1,\r\n    \'five\': 1,\r\n    \'flags\': 1,\r\n    \'flashlight\': 1,\r\n    \'floppy_disk\': 1,\r\n    \'flower_playing_cards\': 1,\r\n    \'flushed\': 1,\r\n    \'foggy\': 1,\r\n    \'football\': 1,\r\n    \'footprints\': 1,\r\n    \'fork_and_knife\': 1,\r\n    \'fountain\': 1,\r\n    \'four\': 1,\r\n    \'four_leaf_clover\': 1,\r\n    \'fr\': 1,\r\n    \'free\': 1,\r\n    \'fried_shrimp\': 1,\r\n    \'fries\': 1,\r\n    \'frog\': 1,\r\n    \'frowning\': 1,\r\n    \'fu\': 1,\r\n    \'fuelpump\': 1,\r\n    \'full_moon\': 1,\r\n    \'full_moon_with_face\': 1,\r\n    \'game_die\': 1,\r\n    \'gb\': 1,\r\n    \'gem\': 1,\r\n    \'gemini\': 1,\r\n    \'ghost\': 1,\r\n    \'gift\': 1,\r\n    \'gift_heart\': 1,\r\n    \'girl\': 1,\r\n    \'globe_with_meridians\': 1,\r\n    \'goat\': 1,\r\n    \'goberserk\': 1,\r\n    \'godmode\': 1,\r\n    \'golf\': 1,\r\n    \'grapes\': 1,\r\n    \'green_apple\': 1,\r\n    \'green_book\': 1,\r\n    \'green_heart\': 1,\r\n    \'grey_exclamation\': 1,\r\n    \'grey_question\': 1,\r\n    \'grimacing\': 1,\r\n    \'grin\': 1,\r\n    \'grinning\': 1,\r\n    \'guardsman\': 1,\r\n    \'guitar\': 1,\r\n    \'gun\': 1,\r\n    \'haircut\': 1,\r\n    \'hamburger\': 1,\r\n    \'hammer\': 1,\r\n    \'hamster\': 1,\r\n    \'hand\': 1,\r\n    \'handbag\': 1,\r\n    \'hankey\': 1,\r\n    \'hash\': 1,\r\n    \'hatched_chick\': 1,\r\n    \'hatching_chick\': 1,\r\n    \'headphones\': 1,\r\n    \'hear_no_evil\': 1,\r\n    \'heart\': 1,\r\n    \'heart_decoration\': 1,\r\n    \'heart_eyes\': 1,\r\n    \'heart_eyes_cat\': 1,\r\n    \'heartbeat\': 1,\r\n    \'heartpulse\': 1,\r\n    \'hearts\': 1,\r\n    \'heavy_check_mark\': 1,\r\n    \'heavy_division_sign\': 1,\r\n    \'heavy_dollar_sign\': 1,\r\n    \'heavy_exclamation_mark\': 1,\r\n    \'heavy_minus_sign\': 1,\r\n    \'heavy_multiplication_x\': 1,\r\n    \'heavy_plus_sign\': 1,\r\n    \'helicopter\': 1,\r\n    \'herb\': 1,\r\n    \'hibiscus\': 1,\r\n    \'high_brightness\': 1,\r\n    \'high_heel\': 1,\r\n    \'hocho\': 1,\r\n    \'honey_pot\': 1,\r\n    \'honeybee\': 1,\r\n    \'horse\': 1,\r\n    \'horse_racing\': 1,\r\n    \'hospital\': 1,\r\n    \'hotel\': 1,\r\n    \'hotsprings\': 1,\r\n    \'hourglass\': 1,\r\n    \'hourglass_flowing_sand\': 1,\r\n    \'house\': 1,\r\n    \'house_with_garden\': 1,\r\n    \'hurtrealbad\': 1,\r\n    \'hushed\': 1,\r\n    \'ice_cream\': 1,\r\n    \'icecream\': 1,\r\n    \'id\': 1,\r\n    \'ideograph_advantage\': 1,\r\n    \'imp\': 1,\r\n    \'inbox_tray\': 1,\r\n    \'incoming_envelope\': 1,\r\n    \'information_desk_person\': 1,\r\n    \'information_source\': 1,\r\n    \'innocent\': 1,\r\n    \'interrobang\': 1,\r\n    \'iphone\': 1,\r\n    \'it\': 1,\r\n    \'izakaya_lantern\': 1,\r\n    \'jack_o_lantern\': 1,\r\n    \'japan\': 1,\r\n    \'japanese_castle\': 1,\r\n    \'japanese_goblin\': 1,\r\n    \'japanese_ogre\': 1,\r\n    \'jeans\': 1,\r\n    \'joy\': 1,\r\n    \'joy_cat\': 1,\r\n    \'jp\': 1,\r\n    \'key\': 1,\r\n    \'keycap_ten\': 1,\r\n    \'kimono\': 1,\r\n    \'kiss\': 1,\r\n    \'kissing\': 1,\r\n    \'kissing_cat\': 1,\r\n    \'kissing_closed_eyes\': 1,\r\n    \'kissing_heart\': 1,\r\n    \'kissing_smiling_eyes\': 1,\r\n    \'koala\': 1,\r\n    \'koko\': 1,\r\n    \'kr\': 1,\r\n    \'lantern\': 1,\r\n    \'large_blue_circle\': 1,\r\n    \'large_blue_diamond\': 1,\r\n    \'large_orange_diamond\': 1,\r\n    \'last_quarter_moon\': 1,\r\n    \'last_quarter_moon_with_face\': 1,\r\n    \'laughing\': 1,\r\n    \'leaves\': 1,\r\n    \'ledger\': 1,\r\n    \'left_luggage\': 1,\r\n    \'left_right_arrow\': 1,\r\n    \'leftwards_arrow_with_hook\': 1,\r\n    \'lemon\': 1,\r\n    \'leo\': 1,\r\n    \'leopard\': 1,\r\n    \'libra\': 1,\r\n    \'light_rail\': 1,\r\n    \'link\': 1,\r\n    \'lips\': 1,\r\n    \'lipstick\': 1,\r\n    \'lock\': 1,\r\n    \'lock_with_ink_pen\': 1,\r\n    \'lollipop\': 1,\r\n    \'loop\': 1,\r\n    \'loudspeaker\': 1,\r\n    \'love_hotel\': 1,\r\n    \'love_letter\': 1,\r\n    \'low_brightness\': 1,\r\n    \'m\': 1,\r\n    \'mag\': 1,\r\n    \'mag_right\': 1,\r\n    \'mahjong\': 1,\r\n    \'mailbox\': 1,\r\n    \'mailbox_closed\': 1,\r\n    \'mailbox_with_mail\': 1,\r\n    \'mailbox_with_no_mail\': 1,\r\n    \'man\': 1,\r\n    \'man_with_gua_pi_mao\': 1,\r\n    \'man_with_turban\': 1,\r\n    \'mans_shoe\': 1,\r\n    \'maple_leaf\': 1,\r\n    \'mask\': 1,\r\n    \'massage\': 1,\r\n    \'meat_on_bone\': 1,\r\n    \'mega\': 1,\r\n    \'melon\': 1,\r\n    \'memo\': 1,\r\n    \'mens\': 1,\r\n    \'metal\': 1,\r\n    \'metro\': 1,\r\n    \'microphone\': 1,\r\n    \'microscope\': 1,\r\n    \'milky_way\': 1,\r\n    \'minibus\': 1,\r\n    \'minidisc\': 1,\r\n    \'mobile_phone_off\': 1,\r\n    \'money_with_wings\': 1,\r\n    \'moneybag\': 1,\r\n    \'monkey\': 1,\r\n    \'monkey_face\': 1,\r\n    \'monorail\': 1,\r\n    \'moon\': 1,\r\n    \'mortar_board\': 1,\r\n    \'mount_fuji\': 1,\r\n    \'mountain_bicyclist\': 1,\r\n    \'mountain_cableway\': 1,\r\n    \'mountain_railway\': 1,\r\n    \'mouse\': 1,\r\n    \'mouse2\': 1,\r\n    \'movie_camera\': 1,\r\n    \'moyai\': 1,\r\n    \'muscle\': 1,\r\n    \'mushroom\': 1,\r\n    \'musical_keyboard\': 1,\r\n    \'musical_note\': 1,\r\n    \'musical_score\': 1,\r\n    \'mute\': 1,\r\n    \'nail_care\': 1,\r\n    \'name_badge\': 1,\r\n    \'neckbeard\': 1,\r\n    \'necktie\': 1,\r\n    \'negative_squared_cross_mark\': 1,\r\n    \'neutral_face\': 1,\r\n    \'new\': 1,\r\n    \'new_moon\': 1,\r\n    \'new_moon_with_face\': 1,\r\n    \'newspaper\': 1,\r\n    \'ng\': 1,\r\n    \'nine\': 1,\r\n    \'no_bell\': 1,\r\n    \'no_bicycles\': 1,\r\n    \'no_entry\': 1,\r\n    \'no_entry_sign\': 1,\r\n    \'no_good\': 1,\r\n    \'no_mobile_phones\': 1,\r\n    \'no_mouth\': 1,\r\n    \'no_pedestrians\': 1,\r\n    \'no_smoking\': 1,\r\n    \'non-potable_water\': 1,\r\n    \'nose\': 1,\r\n    \'notebook\': 1,\r\n    \'notebook_with_decorative_cover\': 1,\r\n    \'notes\': 1,\r\n    \'nut_and_bolt\': 1,\r\n    \'o\': 1,\r\n    \'o2\': 1,\r\n    \'ocean\': 1,\r\n    \'octocat\': 1,\r\n    \'octopus\': 1,\r\n    \'oden\': 1,\r\n    \'office\': 1,\r\n    \'ok\': 1,\r\n    \'ok_hand\': 1,\r\n    \'ok_woman\': 1,\r\n    \'older_man\': 1,\r\n    \'older_woman\': 1,\r\n    \'on\': 1,\r\n    \'oncoming_automobile\': 1,\r\n    \'oncoming_bus\': 1,\r\n    \'oncoming_police_car\': 1,\r\n    \'oncoming_taxi\': 1,\r\n    \'one\': 1,\r\n    \'open_book\': 1,\r\n    \'open_file_folder\': 1,\r\n    \'open_hands\': 1,\r\n    \'open_mouth\': 1,\r\n    \'ophiuchus\': 1,\r\n    \'orange_book\': 1,\r\n    \'outbox_tray\': 1,\r\n    \'ox\': 1,\r\n    \'package\': 1,\r\n    \'page_facing_up\': 1,\r\n    \'page_with_curl\': 1,\r\n    \'pager\': 1,\r\n    \'palm_tree\': 1,\r\n    \'panda_face\': 1,\r\n    \'paperclip\': 1,\r\n    \'parking\': 1,\r\n    \'part_alternation_mark\': 1,\r\n    \'partly_sunny\': 1,\r\n    \'passport_control\': 1,\r\n    \'paw_prints\': 1,\r\n    \'peach\': 1,\r\n    \'pear\': 1,\r\n    \'pencil\': 1,\r\n    \'pencil2\': 1,\r\n    \'penguin\': 1,\r\n    \'pensive\': 1,\r\n    \'performing_arts\': 1,\r\n    \'persevere\': 1,\r\n    \'person_frowning\': 1,\r\n    \'person_with_blond_hair\': 1,\r\n    \'person_with_pouting_face\': 1,\r\n    \'phone\': 1,\r\n    \'pig\': 1,\r\n    \'pig_nose\': 1,\r\n    \'pig2\': 1,\r\n    \'pill\': 1,\r\n    \'pineapple\': 1,\r\n    \'pisces\': 1,\r\n    \'pizza\': 1,\r\n    \'point_down\': 1,\r\n    \'point_left\': 1,\r\n    \'point_right\': 1,\r\n    \'point_up\': 1,\r\n    \'point_up_2\': 1,\r\n    \'police_car\': 1,\r\n    \'poodle\': 1,\r\n    \'poop\': 1,\r\n    \'post_office\': 1,\r\n    \'postal_horn\': 1,\r\n    \'postbox\': 1,\r\n    \'potable_water\': 1,\r\n    \'pouch\': 1,\r\n    \'poultry_leg\': 1,\r\n    \'pound\': 1,\r\n    \'pouting_cat\': 1,\r\n    \'pray\': 1,\r\n    \'princess\': 1,\r\n    \'punch\': 1,\r\n    \'purple_heart\': 1,\r\n    \'purse\': 1,\r\n    \'pushpin\': 1,\r\n    \'put_litter_in_its_place\': 1,\r\n    \'question\': 1,\r\n    \'rabbit\': 1,\r\n    \'rabbit2\': 1,\r\n    \'racehorse\': 1,\r\n    \'radio\': 1,\r\n    \'radio_button\': 1,\r\n    \'rage\': 1,\r\n    \'rage1\': 1,\r\n    \'rage2\': 1,\r\n    \'rage3\': 1,\r\n    \'rage4\': 1,\r\n    \'railway_car\': 1,\r\n    \'rainbow\': 1,\r\n    \'raised_hand\': 1,\r\n    \'raised_hands\': 1,\r\n    \'raising_hand\': 1,\r\n    \'ram\': 1,\r\n    \'ramen\': 1,\r\n    \'rat\': 1,\r\n    \'recycle\': 1,\r\n    \'red_car\': 1,\r\n    \'red_circle\': 1,\r\n    \'registered\': 1,\r\n    \'relaxed\': 1,\r\n    \'relieved\': 1,\r\n    \'repeat\': 1,\r\n    \'repeat_one\': 1,\r\n    \'restroom\': 1,\r\n    \'revolving_hearts\': 1,\r\n    \'rewind\': 1,\r\n    \'ribbon\': 1,\r\n    \'rice\': 1,\r\n    \'rice_ball\': 1,\r\n    \'rice_cracker\': 1,\r\n    \'rice_scene\': 1,\r\n    \'ring\': 1,\r\n    \'rocket\': 1,\r\n    \'roller_coaster\': 1,\r\n    \'rooster\': 1,\r\n    \'rose\': 1,\r\n    \'rotating_light\': 1,\r\n    \'round_pushpin\': 1,\r\n    \'rowboat\': 1,\r\n    \'ru\': 1,\r\n    \'rugby_football\': 1,\r\n    \'runner\': 1,\r\n    \'running\': 1,\r\n    \'running_shirt_with_sash\': 1,\r\n    \'sa\': 1,\r\n    \'sagittarius\': 1,\r\n    \'sailboat\': 1,\r\n    \'sake\': 1,\r\n    \'sandal\': 1,\r\n    \'santa\': 1,\r\n    \'satellite\': 1,\r\n    \'satisfied\': 1,\r\n    \'saxophone\': 1,\r\n    \'school\': 1,\r\n    \'school_satchel\': 1,\r\n    \'scissors\': 1,\r\n    \'scorpius\': 1,\r\n    \'scream\': 1,\r\n    \'scream_cat\': 1,\r\n    \'scroll\': 1,\r\n    \'seat\': 1,\r\n    \'secret\': 1,\r\n    \'see_no_evil\': 1,\r\n    \'seedling\': 1,\r\n    \'seven\': 1,\r\n    \'shaved_ice\': 1,\r\n    \'sheep\': 1,\r\n    \'shell\': 1,\r\n    \'ship\': 1,\r\n    \'shipit\': 1,\r\n    \'shirt\': 1,\r\n    \'shit\': 1,\r\n    \'shoe\': 1,\r\n    \'shower\': 1,\r\n    \'signal_strength\': 1,\r\n    \'six\': 1,\r\n    \'six_pointed_star\': 1,\r\n    \'ski\': 1,\r\n    \'skull\': 1,\r\n    \'sleeping\': 1,\r\n    \'sleepy\': 1,\r\n    \'slot_machine\': 1,\r\n    \'small_blue_diamond\': 1,\r\n    \'small_orange_diamond\': 1,\r\n    \'small_red_triangle\': 1,\r\n    \'small_red_triangle_down\': 1,\r\n    \'smile\': 1,\r\n    \'smile_cat\': 1,\r\n    \'smiley\': 1,\r\n    \'smiley_cat\': 1,\r\n    \'smiling_imp\': 1,\r\n    \'smirk\': 1,\r\n    \'smirk_cat\': 1,\r\n    \'smoking\': 1,\r\n    \'snail\': 1,\r\n    \'snake\': 1,\r\n    \'snowboarder\': 1,\r\n    \'snowflake\': 1,\r\n    \'snowman\': 1,\r\n    \'sob\': 1,\r\n    \'soccer\': 1,\r\n    \'soon\': 1,\r\n    \'sos\': 1,\r\n    \'sound\': 1,\r\n    \'space_invader\': 1,\r\n    \'spades\': 1,\r\n    \'spaghetti\': 1,\r\n    \'sparkle\': 1,\r\n    \'sparkler\': 1,\r\n    \'sparkles\': 1,\r\n    \'sparkling_heart\': 1,\r\n    \'speak_no_evil\': 1,\r\n    \'speaker\': 1,\r\n    \'speech_balloon\': 1,\r\n    \'speedboat\': 1,\r\n    \'squirrel\': 1,\r\n    \'star\': 1,\r\n    \'star2\': 1,\r\n    \'stars\': 1,\r\n    \'station\': 1,\r\n    \'statue_of_liberty\': 1,\r\n    \'steam_locomotive\': 1,\r\n    \'stew\': 1,\r\n    \'straight_ruler\': 1,\r\n    \'strawberry\': 1,\r\n    \'stuck_out_tongue\': 1,\r\n    \'stuck_out_tongue_closed_eyes\': 1,\r\n    \'stuck_out_tongue_winking_eye\': 1,\r\n    \'sun_with_face\': 1,\r\n    \'sunflower\': 1,\r\n    \'sunglasses\': 1,\r\n    \'sunny\': 1,\r\n    \'sunrise\': 1,\r\n    \'sunrise_over_mountains\': 1,\r\n    \'surfer\': 1,\r\n    \'sushi\': 1,\r\n    \'suspect\': 1,\r\n    \'suspension_railway\': 1,\r\n    \'sweat\': 1,\r\n    \'sweat_drops\': 1,\r\n    \'sweat_smile\': 1,\r\n    \'sweet_potato\': 1,\r\n    \'swimmer\': 1,\r\n    \'symbols\': 1,\r\n    \'syringe\': 1,\r\n    \'tada\': 1,\r\n    \'tanabata_tree\': 1,\r\n    \'tangerine\': 1,\r\n    \'taurus\': 1,\r\n    \'taxi\': 1,\r\n    \'tea\': 1,\r\n    \'telephone\': 1,\r\n    \'telephone_receiver\': 1,\r\n    \'telescope\': 1,\r\n    \'tennis\': 1,\r\n    \'tent\': 1,\r\n    \'thought_balloon\': 1,\r\n    \'three\': 1,\r\n    \'thumbsdown\': 1,\r\n    \'thumbsup\': 1,\r\n    \'ticket\': 1,\r\n    \'tiger\': 1,\r\n    \'tiger2\': 1,\r\n    \'tired_face\': 1,\r\n    \'tm\': 1,\r\n    \'toilet\': 1,\r\n    \'tokyo_tower\': 1,\r\n    \'tomato\': 1,\r\n    \'tongue\': 1,\r\n    \'top\': 1,\r\n    \'tophat\': 1,\r\n    \'tractor\': 1,\r\n    \'traffic_light\': 1,\r\n    \'train\': 1,\r\n    \'train2\': 1,\r\n    \'tram\': 1,\r\n    \'triangular_flag_on_post\': 1,\r\n    \'triangular_ruler\': 1,\r\n    \'trident\': 1,\r\n    \'triumph\': 1,\r\n    \'trolleybus\': 1,\r\n    \'trollface\': 1,\r\n    \'trophy\': 1,\r\n    \'tropical_drink\': 1,\r\n    \'tropical_fish\': 1,\r\n    \'truck\': 1,\r\n    \'trumpet\': 1,\r\n    \'tshirt\': 1,\r\n    \'tulip\': 1,\r\n    \'turtle\': 1,\r\n    \'tv\': 1,\r\n    \'twisted_rightwards_arrows\': 1,\r\n    \'two\': 1,\r\n    \'two_hearts\': 1,\r\n    \'two_men_holding_hands\': 1,\r\n    \'two_women_holding_hands\': 1,\r\n    \'u5272\': 1,\r\n    \'u5408\': 1,\r\n    \'u55b6\': 1,\r\n    \'u6307\': 1,\r\n    \'u6708\': 1,\r\n    \'u6709\': 1,\r\n    \'u6e80\': 1,\r\n    \'u7121\': 1,\r\n    \'u7533\': 1,\r\n    \'u7981\': 1,\r\n    \'u7a7a\': 1,\r\n    \'uk\': 1,\r\n    \'umbrella\': 1,\r\n    \'unamused\': 1,\r\n    \'underage\': 1,\r\n    \'unlock\': 1,\r\n    \'up\': 1,\r\n    \'us\': 1,\r\n    \'v\': 1,\r\n    \'vertical_traffic_light\': 1,\r\n    \'vhs\': 1,\r\n    \'vibration_mode\': 1,\r\n    \'video_camera\': 1,\r\n    \'video_game\': 1,\r\n    \'violin\': 1,\r\n    \'virgo\': 1,\r\n    \'volcano\': 1,\r\n    \'vs\': 1,\r\n    \'walking\': 1,\r\n    \'waning_crescent_moon\': 1,\r\n    \'waning_gibbous_moon\': 1,\r\n    \'warning\': 1,\r\n    \'watch\': 1,\r\n    \'water_buffalo\': 1,\r\n    \'watermelon\': 1,\r\n    \'wave\': 1,\r\n    \'wavy_dash\': 1,\r\n    \'waxing_crescent_moon\': 1,\r\n    \'waxing_gibbous_moon\': 1,\r\n    \'wc\': 1,\r\n    \'weary\': 1,\r\n    \'wedding\': 1,\r\n    \'whale\': 1,\r\n    \'whale2\': 1,\r\n    \'wheelchair\': 1,\r\n    \'white_check_mark\': 1,\r\n    \'white_circle\': 1,\r\n    \'white_flower\': 1,\r\n    \'white_large_square\': 1,\r\n    \'white_medium_small_square\': 1,\r\n    \'white_medium_square\': 1,\r\n    \'white_small_square\': 1,\r\n    \'white_square_button\': 1,\r\n    \'wind_chime\': 1,\r\n    \'wine_glass\': 1,\r\n    \'wink\': 1,\r\n    \'wolf\': 1,\r\n    \'woman\': 1,\r\n    \'womans_clothes\': 1,\r\n    \'womans_hat\': 1,\r\n    \'womens\': 1,\r\n    \'worried\': 1,\r\n    \'wrench\': 1,\r\n    \'x\': 1,\r\n    \'yellow_heart\': 1,\r\n    \'yen\': 1,\r\n    \'yum\': 1,\r\n    \'zap\': 1,\r\n    \'zero\': 1,\r\n    \'zzz\': 1\r\n  };\r\n\r\n  return ChatHistory;\r\n});\r\n\n//@ sourceURL=/js/ChatHistory.js");

eval("// PatterEmbed.js\r\n//\r\n// An embeddable version of Patter. It provides handlers for chat\r\n// history, chat input, and a user list. It is up to the caller to feed\r\n// it new messages and a channel to post in.\r\n\r\n/*global define:true */\r\ndefine(\'js/PatterEmbed\',[\'jquery\', \'js/ChatForm\', \'js/UserList\', \'js/ChatHistory\'],\r\nfunction ($, ChatForm, UserList, ChatHistory) {\r\n  \'use strict\';\r\n\r\n  function PatterEmbed(channel, members,\r\n                       formRoot, userRoot, historyRoot, postCallback)\r\n  {\r\n    this.form = new ChatForm(formRoot, channel, postCallback);\r\n    var insertCallback = $.proxy(this.form.insertUserIntoText, this.form);\r\n    this.user = new UserList(userRoot, insertCallback);\r\n    this.history = new ChatHistory(historyRoot, insertCallback,\r\n                                  this.user.avatars);\r\n    this.user.updateChannel(channel, members);\r\n  }\r\n\r\n  PatterEmbed.prototype.addPosts = function (posts, goBack)\r\n  {\r\n    this.user.updatePosts(posts);\r\n    this.history.update(posts, goBack);\r\n  };\r\n\r\n  return PatterEmbed;\r\n});\r\n\n//@ sourceURL=/js/PatterEmbed.js");

eval("// RoomFeed.js\n//\n// Fetches latest messages from room channel periodically and uses a\n// PatterEmbed to display them.\n\n/*global define:true */\ndefine(\'js/RoomFeed\',[\'jquery\', \'util\', \'appnet\', \'js/PatterEmbed\'],\nfunction ($, util, appnet, PatterEmbed) {\n  \'use strict\';\n\n  function RoomFeed(channel, members, formRoot, userRoot, historyRoot)\n  {\n    this.embed = new PatterEmbed(channel, members, formRoot, userRoot,\n                                 historyRoot, $.proxy(this.update, this));\n    this.channel = channel;\n    this.goBack = false;\n    this.timer = null;\n    this.earliest = null;\n    this.latest = null;\n    this.shownFeed = false;\n    this.more = true;\n    this.markerName = null;\n  }\n\n  RoomFeed.prototype.checkFeed = function ()\n  {\n    clearTimeout(this.timer);\n    //    $(\'#loading-message\').html(\"Fetching Messages From Channel\");\n    \n    // Should the feed load older messages or newer ones.\n    var scroll = this.embed.history.root.scrollTop();\n    var height = this.embed.history.root.prop(\'scrollHeight\');\n    this.goBack = this.shownFeed && this.more && (scroll <= height / 3);\n\n    var options = {\n      include_annotations: 1,\n      count: 200\n    };\n    \n    if (! this.shownFeed) {\n      options.count = 40;\n    }\n    if (this.goBack && this.earliest !== null) {\n      options.before_id = this.earliest;\n    }\n    if (!this.goBack && this.latest !== null) {\n      options.since_id = this.latest;\n    }\n    appnet.api.getMessages(this.channel.id, options,\n                           $.proxy(completeFeed, this),\n                           $.proxy(failFeed, this));\n    this.timer = setTimeout($.proxy(this.checkFeed, this), 20000);\n  };\n\n  var completeFeed = function (response)\n  {\n    clearTimeout(this.timer);\n    if (this.goBack && ! response.meta.more) {\n      this.more = false;\n    }\n    if (response.meta.min_id !== undefined) {\n      if (this.earliest === null || response.meta.min_id < this.earliest) {\n        this.earliest = response.meta.min_id;\n      }\n    }\n    if (response.meta.max_id !== undefined) {\n      if (this.latest === null || response.meta.max_id > this.latest) {\n        this.latest = response.meta.max_id;\n      }\n    }\n\n    this.update(response.data, response.meta.marker, response.meta.max_id);\n\n    if (! this.shownFeed) {\n      this.shownFeed = true;\n    }\n    this.embed.history.checkBottom();\n    var time = 2000;\n    if (! util.has_focus) {\n      time = 10000;\n    }\n\n    this.timer = setTimeout($.proxy(this.checkFeed, this), time);\n  };\n\n  RoomFeed.prototype.update = function (posts, marker, inMaxId)\n  {\n    var maxId = inMaxId;\n    if (! maxId)\n    {\n      if (posts.length > 0)\n      {\n        maxId = posts[0].id;\n      }\n    }\n\n    this.embed.addPosts(posts, this.goBack);\n\n    if (marker)\n    {\n      this.markerName = marker.name;\n    }\n    if (maxId && this.markerName &&\n        (! marker || ! marker.id || maxId > marker.id))\n    {\n      changeMarker(this.markerName, maxId);\n    }\n  };\n\n  var failFeed = function (meta)\n  {\n  };\n\n  function changeMarker(markerName, id)\n  {\n    if (markerName !== null && id !== null)\n    {\n      var marker = {\n        id: id,\n        name: markerName\n      };\n      appnet.api.updateMarker(marker, null, null, null);\n    }\n  }\n\n  return RoomFeed;\n});\n\n//@ sourceURL=/js/RoomFeed.js");

// room.js
//
// Overall task for managing a room

/*global require: true */
require(['jquery', 'util', 'appnet', 'js/roomInfo', 'js/roomMenu',
         'js/RoomFeed'],
function ($, util, appnet, roomInfo, roomMenu, RoomFeed) {
  
  
  var feed = null;

  function completeChannel()
  {
    if (roomInfo.channel !== null)
    {
      if (feed === null)
      {
        feed = new RoomFeed(roomInfo.channel, roomInfo.members,
                            $('.chat-input-row'), $('.user-list'),
                            $('.chat-history'));
        feed.checkFeed();
        roomMenu.init($('#room-menu'), feed.embed.history);
      }
      else
      {
        roomMenu.updateChannelView();
        feed.embed.user.updateChannel(roomInfo.channel, roomInfo.members);
      }
    }
    else
    {
      failChannel();
    }
  }

  function failChannel()
  {
    console.log('failChannel');
    util.redirect('index.html');
  }

  function failUser()
  {
    console.log('failUser');
    roomInfo.updateChannel();
  }

  function initialize()
  {
    var params = util.getUrlVars();
    var newRoom = params.channel;
    appnet.init('patter2Token', 'patterPrevUrl');
    if (! newRoom)
    {
      util.redirect('auth.html');
    }
    roomInfo.id = newRoom;
    roomInfo.changeCallback = completeChannel;
    if (appnet.isLogged())
    {
      appnet.updateUser($.proxy(roomInfo.updateChannel, roomInfo), failUser);
    }
    else
    {
      roomInfo.updateChannel();
    }
  }
/*

//function showMessage(

function initializePatter(newRoom) {
  $("#main-fail").hide();
  $("#form-post").hide();
  $("#must-authorize").hide();
  $("#read-only").hide();
  $("#loading-modal").modal({backdrop: 'static', keyboard: false});
  $(window).resize(scrollChatToBottom);
  chatRoom = newRoom;

  initButtons();
  initEmbedModal();
  initEditRoomModal();
  if (appnet.isLogged()) {
    $('#loading-message').html("Fetching User Information");
    appnet.updateUser(resetWindow, $.proxy(initFail, 'User Lookup'));
  } else {
    resetWindow();
  }
}

function initFail(meta) {
  $("#main-fail").show();
}

function initButtons() {
}

function resetWindow()
{
  clearTimeout(processTimer);
  currentChannel = null;
  namedUsers = {};
  userPostTimes = {};
  avatarUrls = {};
  lastUserList = "";
  if (appnet.user !== null) {
    namedUsers[appnet.user.username] = 1;
    userPostTimes[appnet.user.username] = null;
    avatarUrls[appnet.user.username] = appnet.user.avatar_image.url;
  }

  $("#main_post").val("");
  $("#global-tab-container").empty();
  $("#user-list").empty();

  if (! appnet.isLogged() && chatRoom === null) {
    appnet.api.authorize();
  } else if (chatRoom === null) {
    util.redirect("index.html");
  } else {
    getChannelInfo();
  }
}

*/
  $(document).ready(initialize);

});

define("js/room", function(){});
